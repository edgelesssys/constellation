"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[9414],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var s=t(96540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},73129:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"workflows/verify-cluster","title":"Verify your cluster","description":"Constellation\'s attestation feature allows you, or a third party, to verify the integrity and confidentiality of your Constellation cluster.","source":"@site/versioned_docs/version-2.24/workflows/verify-cluster.md","sourceDirName":"workflows","slug":"/workflows/verify-cluster","permalink":"/constellation/workflows/verify-cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.24/workflows/verify-cluster.md","tags":[],"version":"2.24","frontMatter":{},"sidebar":"docs","previous":{"title":"Recover your cluster","permalink":"/constellation/workflows/recovery"},"next":{"title":"Use persistent storage","permalink":"/constellation/workflows/storage"}}');var r=t(74848),i=t(28453);const o={},l="Verify your cluster",a={},c=[{value:"Fetch measurements",id:"fetch-measurements",level:2},{value:"The <em>verify</em> command",id:"the-verify-command",level:2},{value:"Custom arguments",id:"custom-arguments",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"verify-your-cluster",children:"Verify your cluster"})}),"\n",(0,r.jsxs)(n.p,{children:["Constellation's ",(0,r.jsx)(n.a,{href:"/constellation/architecture/attestation",children:"attestation feature"})," allows you, or a third party, to verify the integrity and confidentiality of your Constellation cluster."]}),"\n",(0,r.jsx)(n.h2,{id:"fetch-measurements",children:"Fetch measurements"}),"\n",(0,r.jsx)(n.p,{children:"To verify the integrity of Constellation you need trusted measurements to verify against. For each node image released by Edgeless Systems, there are signed measurements, which you can download using the CLI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"constellation config fetch-measurements\n"})}),"\n",(0,r.jsx)(n.p,{children:"This command performs the following steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Download the signed measurements for the configured image. By default, this will use Edgeless Systems' public measurement registry."}),"\n",(0,r.jsxs)(n.li,{children:["Verify the signature of the measurements. This will use Edgeless Systems' ",(0,r.jsx)(n.a,{href:"https://edgeless.systems/es.pub",children:"public key"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Write measurements into configuration file."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The configuration file then contains a list of ",(0,r.jsx)(n.code,{children:"measurements"})," similar to the following:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# ...\nmeasurements:\n    0:\n        expected: "0f35c214608d93c7a6e68ae7359b4a8be5a0e99eea9107ece427c4dea4e439cf"\n        warnOnly: false\n    4:\n        expected: "02c7a67c01ec70ffaf23d73a12f749ab150a8ac6dc529bda2fe1096a98bf42ea"\n        warnOnly: false\n    5:\n        expected: "e6949026b72e5045706cd1318889b3874480f7a3f7c5c590912391a2d15e6975"\n        warnOnly: true\n    8:\n        expected: "0000000000000000000000000000000000000000000000000000000000000000"\n        warnOnly: false\n    9:\n        expected: "f0a6e8601b00e2fdc57195686cd4ef45eb43a556ac1209b8e25d993213d68384"\n        warnOnly: false\n    11:\n        expected: "0000000000000000000000000000000000000000000000000000000000000000"\n        warnOnly: false\n    12:\n        expected: "da99eb6cf7c7fbb692067c87fd5ca0b7117dc293578e4fea41f95d3d3d6af5e2"\n        warnOnly: false\n    13:\n        expected: "0000000000000000000000000000000000000000000000000000000000000000"\n        warnOnly: false\n    14:\n        expected: "d7c4cc7ff7933022f013e03bdee875b91720b5b86cf1753cad830f95e791926f"\n        warnOnly: true\n    15:\n        expected: "0000000000000000000000000000000000000000000000000000000000000000"\n        warnOnly: false\n# ...\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Each entry specifies the expected value of the Constellation node, and whether the measurement should be enforced (",(0,r.jsx)(n.code,{children:"warnOnly: false"}),"), or only a warning should be logged (",(0,r.jsx)(n.code,{children:"warnOnly: true"}),").\nBy default, the subset of the ",(0,r.jsx)(n.a,{href:"/constellation/architecture/attestation#runtime-measurements",children:"available measurements"})," that can be locally reproduced and verified is enforced."]}),"\n",(0,r.jsxs)(n.p,{children:["During attestation, the validating side (CLI or ",(0,r.jsx)(n.a,{href:"/constellation/architecture/microservices#joinservice",children:"join service"}),") compares each measurement reported by the issuing side (first node or joining node) individually.\nFor mismatching measurements that have set ",(0,r.jsx)(n.code,{children:"warnOnly"})," to ",(0,r.jsx)(n.code,{children:"true"})," only a warning is emitted.\nFor mismatching measurements that have set ",(0,r.jsx)(n.code,{children:"warnOnly"})," to ",(0,r.jsx)(n.code,{children:"false"})," an error is emitted and attestation fails.\nIf attestation fails for a new node, it isn't permitted to join the cluster."]}),"\n",(0,r.jsxs)(n.h2,{id:"the-verify-command",children:["The ",(0,r.jsx)(n.em,{children:"verify"})," command"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The steps below are purely optional. They're automatically executed by ",(0,r.jsx)(n.code,{children:"constellation apply"})," when you initialize your cluster. The ",(0,r.jsx)(n.code,{children:"constellation verify"})," command mostly has an illustrative purpose."]})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"verify"})," command obtains and verifies an attestation statement from a running Constellation cluster."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"constellation verify [--cluster-id ...]\n"})}),"\n",(0,r.jsx)(n.p,{children:"From the attestation statement, the command verifies the following properties:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The cluster is using the correct Confidential VM (CVM) type."}),"\n",(0,r.jsx)(n.li,{children:"Inside the CVMs, the correct node images are running. The node images are identified through the measurements obtained in the previous step."}),"\n",(0,r.jsxs)(n.li,{children:["The unique ID of the cluster matches the one from your ",(0,r.jsx)(n.code,{children:"constellation-state.yaml"})," file or passed in via ",(0,r.jsx)(n.code,{children:"--cluster-id"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Once the above properties are verified, you know that you are talking to the right Constellation cluster and it's in a good and trustworthy shape."}),"\n",(0,r.jsx)(n.h3,{id:"custom-arguments",children:"Custom arguments"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"verify"})," command also allows you to verify any Constellation deployment that you have network access to. For this you need the following:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The IP address of a running Constellation cluster's ",(0,r.jsx)(n.a,{href:"/constellation/architecture/microservices#verificationservice",children:"VerificationService"}),". The ",(0,r.jsx)(n.code,{children:"VerificationService"})," is exposed via a ",(0,r.jsx)(n.code,{children:"NodePort"})," service using the external IP address of your cluster. Run ",(0,r.jsx)(n.code,{children:"kubectl get nodes -o wide"})," and look for ",(0,r.jsx)(n.code,{children:"EXTERNAL-IP"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The cluster's ",(0,r.jsx)(n.em,{children:"clusterID"}),". See ",(0,r.jsx)(n.a,{href:"/constellation/architecture/keys#cluster-identity",children:"cluster identity"})," for more details."]}),"\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.code,{children:"constellation-conf.yaml"})," file with the expected measurements of the cluster in your working directory."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell-session",children:"constellation verify -e 192.0.2.1 --cluster-id Q29uc3RlbGxhdGlvbkRvY3VtZW50YXRpb25TZWNyZXQ=\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);