"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[6067],{28453:(e,s,i)=>{i.d(s,{R:()=>o,x:()=>l});var n=i(96540);const t={},r=n.createContext(t);function o(e){const s=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(r.Provider,{value:s},e.children)}},58263:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"workflows/reproducible-builds","title":"Reproduce released artifacts","description":"Constellation has first-class support for reproducible builds.","source":"@site/versioned_docs/version-2.24/workflows/reproducible-builds.md","sourceDirName":"workflows","slug":"/workflows/reproducible-builds","permalink":"/constellation/workflows/reproducible-builds","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.24/workflows/reproducible-builds.md","tags":[],"version":"2.24","frontMatter":{},"sidebar":"docs","previous":{"title":"Consume SBOMs","permalink":"/constellation/workflows/sbom"},"next":{"title":"Troubleshooting","permalink":"/constellation/workflows/troubleshooting"}}');var t=i(74848),r=i(28453);const o={},l="Reproduce released artifacts",d={},c=[{value:"Build environment prerequisites",id:"build-environment-prerequisites",level:2},{value:"Run the build",id:"run-the-build",level:2},{value:"Feedback",id:"feedback",level:2}];function a(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"reproduce-released-artifacts",children:"Reproduce released artifacts"})}),"\n",(0,t.jsxs)(s.p,{children:["Constellation has first-class support for ",(0,t.jsx)(s.a,{href:"https://reproducible-builds.org",children:"reproducible builds"}),".\nReproducing the released artifacts is an alternative to ",(0,t.jsx)(s.a,{href:"/constellation/workflows/verify-cli",children:"signature verification"})," that doesn't require trusting Edgeless Systems' release process.\nThe following sections describe how to rebuild an artifact and how Constellation ensures that the rebuild reproduces the artifacts bit-by-bit."]}),"\n",(0,t.jsx)(s.h2,{id:"build-environment-prerequisites",children:"Build environment prerequisites"}),"\n",(0,t.jsxs)(s.p,{children:["The build systems used by Constellation - ",(0,t.jsx)(s.a,{href:"https://bazel.build/",children:"Bazel"})," and ",(0,t.jsx)(s.a,{href:"https://nixos.org",children:"Nix"})," - are designed for deterministic, reproducible builds.\nThese two dependencies should be the only prerequisites for a successful build.\nHowever, it can't be ruled out completely that peculiarities of the host affect the build result.\nThus, we recommend the following host setup for best results:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"A Linux operating system not older than v5.4."}),"\n",(0,t.jsxs)(s.li,{children:["The GNU C library not older than v2.31 (avoid ",(0,t.jsx)(s.code,{children:"musl"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["GNU ",(0,t.jsx)(s.code,{children:"coreutils"})," not older than v8.30 (avoid ",(0,t.jsx)(s.code,{children:"busybox"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["An ",(0,t.jsx)(s.code,{children:"ext4"})," filesystem for building."]}),"\n",(0,t.jsx)(s.li,{children:"AppArmor turned off."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This is given, for example, on an Ubuntu 22.04 system, which is also used for reproducibility tests."}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsx)(s.p,{children:"To avoid any backwards-compatibility issues, the host software versions should also not be much newer than the Constellation release."})}),"\n",(0,t.jsx)(s.h2,{id:"run-the-build",children:"Run the build"}),"\n",(0,t.jsxs)(s.p,{children:["The following instructions outline qualitatively how to reproduce a build.\nConstellation implements these instructions in the ",(0,t.jsx)(s.a,{href:"https://github.com/edgelesssys/constellation/actions/workflows/reproducible-builds.yml",children:"Reproducible Builds workflow"}),", which continuously tests for reproducibility.\nThe workflow is a good place to look up specific version numbers and build steps."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Check out the Constellation repository at the tag corresponding to the release."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"git clone https://github.com/edgelesssys/constellation.git\ncd constellation\ngit checkout v2.20.0\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://bazel.build/install",children:"Install the Bazel release"})," specified in ",(0,t.jsx)(s.code,{children:".bazelversion"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.a,{href:"https://nixos.org/download/",children:"Install Nix"})," (any recent version should do)."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Run the build with ",(0,t.jsx)(s.code,{children:"bazel build $target"})," for one of the following targets of interest:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-data",children:"//cli:cli_enterprise_darwin_amd64\n//cli:cli_enterprise_darwin_arm64\n//cli:cli_enterprise_linux_amd64\n//cli:cli_enterprise_linux_arm64\n//cli:cli_enterprise_windows_amd64\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Compare the build result with the downloaded release artifact."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"feedback",children:"Feedback"}),"\n",(0,t.jsxs)(s.p,{children:["Reproduction failures often indicate a bug in the build system or in the build definitions.\nTherefore, we're interested in any reproducibility issues you might encounter.\n",(0,t.jsx)(s.a,{href:"https://github.com/edgelesssys/constellation/issues/new/choose",children:"Start a bug report"})," and describe the details of your build environment.\nMake sure to include your result binary or a ",(0,t.jsx)(s.a,{href:"https://diffoscope.org/",children:(0,t.jsx)(s.code,{children:"diffoscope"})})," report, if possible."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);