"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[3092],{293:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"getting-started/first-steps","title":"First steps with Constellation","description":"The following steps guide you through the process of creating a cluster and deploying a sample app. This example assumes that you have successfully installed and set up Constellation,","source":"@site/versioned_docs/version-2.23/getting-started/first-steps.md","sourceDirName":"getting-started","slug":"/getting-started/first-steps","permalink":"/constellation/2.23/getting-started/first-steps","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.23/getting-started/first-steps.md","tags":[],"version":"2.23","frontMatter":{},"sidebar":"docs","previous":{"title":"Installation","permalink":"/constellation/2.23/getting-started/install"},"next":{"title":"First steps (local)","permalink":"/constellation/2.23/getting-started/first-steps-local"}}');var l=s(74848),o=s(28453);const i={},r="First steps with Constellation",a={},c=[{value:"Create a cluster",id:"create-a-cluster",level:2},{value:"Deploy a sample application",id:"deploy-a-sample-application",level:2},{value:"Terminate your cluster",id:"terminate-your-cluster",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{TabItem:s,Tabs:t}=n;return s||u("TabItem",!0),t||u("Tabs",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"first-steps-with-constellation",children:"First steps with Constellation"})}),"\n",(0,l.jsxs)(n.p,{children:["The following steps guide you through the process of creating a cluster and deploying a sample app. This example assumes that you have successfully ",(0,l.jsx)(n.a,{href:"/constellation/2.23/getting-started/install",children:"installed and set up Constellation"}),",\nand have access to a cloud subscription."]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsxs)(n.p,{children:["If you don't have a cloud subscription, you can also set up a ",(0,l.jsx)(n.a,{href:"/constellation/2.23/getting-started/first-steps-local",children:"local Constellation cluster using virtualization"})," for testing."]})}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["If you encounter any problem with the following steps, make sure to use the ",(0,l.jsx)(n.a,{href:"https://github.com/edgelesssys/constellation/releases/latest",children:"latest release"})," and check out the ",(0,l.jsx)(n.a,{href:"https://github.com/edgelesssys/constellation/issues?q=is%3Aopen+is%3Aissue+label%3A%22known+issue%22",children:"known issues"}),"."]})}),"\n",(0,l.jsx)(n.h2,{id:"create-a-cluster",children:"Create a cluster"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Create the ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/config",children:"configuration file"})," and state file for your cloud provider. If you are following the steps of this guide, there is no need to edit the file."]}),"\n",(0,l.jsxs)(t,{groupId:"csp",children:[(0,l.jsx)(s,{value:"aws",label:"AWS",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation config generate aws\n"})})}),(0,l.jsx)(s,{value:"azure",label:"Azure",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation config generate azure\n"})})}),(0,l.jsx)(s,{value:"gcp",label:"GCP",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation config generate gcp\n"})})}),(0,l.jsx)(s,{value:"stackit",label:"STACKIT",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation config generate stackit\n"})})})]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Create your ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/config#creating-an-iam-configuration",children:"IAM configuration"}),"."]}),"\n",(0,l.jsxs)(t,{groupId:"csp",children:[(0,l.jsxs)(s,{value:"aws",label:"AWS",children:[(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation iam create aws --zone=us-east-2a --prefix=constellTest --update-config\n"})}),(0,l.jsxs)(n.p,{children:["This command creates IAM configuration for the AWS zone ",(0,l.jsx)(n.code,{children:"us-east-2a"})," using the prefix ",(0,l.jsx)(n.code,{children:"constellTest"})," for all named resources being created. It also updates the configuration file ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"})," in your current directory with the IAM values filled in."]}),(0,l.jsxs)(n.p,{children:["Depending on the attestation variant selected on config generation, different regions are available.\nAMD SEV-SNP machines (requires the default attestation variant ",(0,l.jsx)(n.code,{children:"awsSEVSNP"}),") are currently available in the following regions:"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"eu-west-1"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"us-east-2"})}),"\n"]}),(0,l.jsxs)(n.p,{children:["You can find a list of regions that support AMD SEV-SNP in ",(0,l.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snp-requirements.html",children:"AWS's documentation"}),"."]}),(0,l.jsxs)(n.p,{children:["NitroTPM machines (requires the attestation variant ",(0,l.jsx)(n.code,{children:"awsNitroTPM"}),") are available in all regions.\nConstellation OS images are currently replicated to the following regions:"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"eu-central-1"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"eu-west-1"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"eu-west-3"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"us-east-2"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ap-south-1"})}),"\n"]}),(0,l.jsxs)(n.p,{children:["If you require the OS image to be available in another region, ",(0,l.jsx)(n.a,{href:"https://github.com/edgelesssys/constellation/issues/new?assignees=&labels=&template=feature_request.md&title=Support+new+AWS+image+region:+xx-xxxx-x",children:"let us know"}),"."]}),(0,l.jsxs)(n.p,{children:["You can find a list of all ",(0,l.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions",children:"regions in AWS's documentation"}),"."]})]}),(0,l.jsxs)(s,{value:"azure",label:"Azure",children:[(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation iam create azure --subscriptionID 00000000-0000-0000-0000-000000000000 --region=westus --resourceGroup=constellTest --servicePrincipal=spTest --update-config\n"})}),(0,l.jsxs)(n.p,{children:["This command creates IAM configuration on the Azure region ",(0,l.jsx)(n.code,{children:"westus"})," creating a new resource group ",(0,l.jsx)(n.code,{children:"constellTest"})," and a new service principal ",(0,l.jsx)(n.code,{children:"spTest"}),". It also updates the configuration file ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"})," in your current directory with the IAM values filled in."]}),(0,l.jsx)(n.p,{children:"CVMs are available in several Azure regions. Constellation OS images are currently replicated to the following:"}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"germanywestcentral"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"westus"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"eastus"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"northeurope"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"westeurope"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"southeastasia"})}),"\n"]}),(0,l.jsxs)(n.p,{children:["If you require the OS image to be available in another region, ",(0,l.jsx)(n.a,{href:"https://github.com/edgelesssys/constellation/issues/new?assignees=&labels=&template=feature_request.md&title=Support+new+Azure+image+region:+xx-xxxx-x",children:"let us know"}),"."]}),(0,l.jsxs)(n.p,{children:["You can find a list of all ",(0,l.jsx)(n.a,{href:"https://azure.microsoft.com/en-us/global-infrastructure/services/?products=virtual-machines&regions=all",children:"regions in Azure's documentation"}),"."]})]}),(0,l.jsxs)(s,{value:"gcp",label:"GCP",children:[(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation iam create gcp --projectID=yourproject-12345 --zone=europe-west3-a --prefix=constell-test --update-config\n"})}),(0,l.jsxs)(n.p,{children:["This command creates IAM configuration in the GCP project ",(0,l.jsx)(n.code,{children:"yourproject-12345"})," on the GCP zone ",(0,l.jsx)(n.code,{children:"europe-west3-a"})," creating a new service account ",(0,l.jsx)(n.code,{children:"constell-test"}),". It also updates the configuration file ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"})," in your current directory with the IAM values filled in."]}),(0,l.jsxs)(n.p,{children:["Note that only regions offering CVMs of the ",(0,l.jsx)(n.code,{children:"C2D"})," or ",(0,l.jsx)(n.code,{children:"N2D"})," series are supported. You can find a ",(0,l.jsx)(n.a,{href:"https://cloud.google.com/compute/docs/regions-zones#available",children:"list of all regions in Google's documentation"}),", which you can filter by machine type ",(0,l.jsx)(n.code,{children:"C2D"})," or ",(0,l.jsx)(n.code,{children:"N2D"}),"."]})]}),(0,l.jsxs)(s,{value:"stackit",label:"STACKIT",children:[(0,l.jsxs)(n.p,{children:["To use Constellation on STACKIT, the cluster will use the User Access Token (UAT) that's generated ",(0,l.jsx)(n.a,{href:"/constellation/2.23/getting-started/install",children:"during the install step"}),".\nAfter creating the accounts, fill in the STACKIT details in ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"})," under ",(0,l.jsx)(n.code,{children:"provider.openstack"}),":"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"stackitProjectID"}),": STACKIT project id (can be found after login on the ",(0,l.jsx)(n.a,{href:"https://portal.stackit.cloud",children:"STACKIT portal"}),")"]}),"\n"]}),(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"stackitProjectID"})," refers to the ID of your STACKIT project. The STACKIT portal also shows the OpenStack ID that's associated with your project in some places. Make sure you insert the STACKIT project ID in the ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"})," file. It's of the format ",(0,l.jsx)(n.code,{children:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"}),"."]})})]})]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsxs)(n.p,{children:["To learn about all options you have for managing IAM resources and Constellation configuration, see the ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/config",children:"Configuration workflow"}),"."]})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Create the cluster. ",(0,l.jsx)(n.code,{children:"constellation apply"})," uses options set in ",(0,l.jsx)(n.code,{children:"constellation-conf.yaml"}),".\nIf you want to manually manage your cloud resources, for example by using ",(0,l.jsx)(n.a,{href:"/constellation/2.23/reference/terraform",children:"Terraform"}),", follow the corresponding instructions in the ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/create",children:"Create workflow"}),"."]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsx)(n.p,{children:"On Azure, you may need to wait 15+ minutes at this point for role assignments to propagate."})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation apply -y\n"})}),"\n",(0,l.jsx)(n.p,{children:"This should look similar to the following:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell-session",children:'$ constellation apply -y\nChecking for infrastructure changes\nThe following Constellation cluster will be created:\n  3 control-plane nodes of type n2d-standard-4 will be created.\n  1 worker node of type n2d-standard-4 will be created.\nCreating\nCloud infrastructure created successfully\nYour Constellation master secret was successfully written to ./constellation-mastersecret.json\nConnecting\nInitializing cluster\nInstalling Kubernetes components\nYour Constellation cluster was successfully initialized.\n\nConstellation cluster identifier  g6iMP5wRU1b7mpOz2WEISlIYSfdAhB0oNaOg6XEwKFY=\nKubernetes configuration          constellation-admin.conf\n\nYou can now connect to your cluster by executing:\n        export KUBECONFIG="$PWD/constellation-admin.conf"\n'})}),"\n",(0,l.jsxs)(n.p,{children:["The cluster's identifier will be different in your output.\nKeep ",(0,l.jsx)(n.code,{children:"constellation-mastersecret.json"})," somewhere safe.\nThis will allow you to ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/recovery",children:"recover your cluster"})," in case of a disaster."]}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsxs)(n.p,{children:["Depending on your CSP and region, ",(0,l.jsx)(n.code,{children:"constellation apply"})," may take 10+ minutes to complete."]})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Configure kubectl."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export KUBECONFIG="$PWD/constellation-admin.conf"\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"deploy-a-sample-application",children:"Deploy a sample application"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Deploy the ",(0,l.jsx)(n.a,{href:"https://github.com/BuoyantIO/emojivoto",children:"emojivoto app"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl apply -k github.com/BuoyantIO/emojivoto/kustomize/deployment\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Expose the frontend service locally"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl wait --for=condition=available --timeout=60s -n emojivoto --all deployments\nkubectl -n emojivoto port-forward svc/web-svc 8080:80 &\ncurl http://localhost:8080\nkill %1\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"terminate-your-cluster",children:"Terminate your cluster"}),"\n",(0,l.jsxs)(n.p,{children:["Use the CLI to terminate your cluster. If you manually used ",(0,l.jsx)(n.a,{href:"/constellation/2.23/reference/terraform",children:"Terraform"})," to manage your cloud resources, follow the corresponding instructions in the ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/terminate",children:"Terminate workflow"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"constellation terminate\n"})}),"\n",(0,l.jsx)(n.p,{children:"This should give the following output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell-session",children:"$ constellation terminate\nYou are about to terminate a Constellation cluster.\nAll of its associated resources will be DESTROYED.\nThis action is irreversible and ALL DATA WILL BE LOST.\nDo you want to continue? [y/n]:\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Confirm with ",(0,l.jsx)(n.code,{children:"y"})," to terminate the cluster:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell-session",children:"Terminating ...\nYour Constellation cluster was terminated successfully.\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Optionally, you can also ",(0,l.jsx)(n.a,{href:"/constellation/2.23/workflows/config#deleting-an-iam-configuration",children:"delete your IAM resources"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(96540);const l={},o=t.createContext(l);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);