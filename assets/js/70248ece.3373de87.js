"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[6373],{23925:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"workflows/verify-cli","title":"Verify the CLI","description":"This recording presents the essence of this page. It\'s recommended to read it in full for the motivation and all details.","source":"@site/versioned_docs/version-2.22/workflows/verify-cli.md","sourceDirName":"workflows","slug":"/workflows/verify-cli","permalink":"/constellation/2.22/workflows/verify-cli","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.22/workflows/verify-cli.md","tags":[],"version":"2.22","frontMatter":{},"sidebar":"docs","previous":{"title":"Workflows","permalink":"/constellation/2.22/category/workflows"},"next":{"title":"Configure your cluster","permalink":"/constellation/2.22/workflows/config"}}');var i=n(74848),o=n(28453);const r={},a="Verify the CLI",l={},c=[{value:"Verify the signature",id:"verify-the-signature",level:2},{value:"Optional: Manually inspect the transparency log",id:"optional-manually-inspect-the-transparency-log",level:3},{value:"Verify the provenance",id:"verify-the-provenance",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",...(0,o.R)(),...e.components},{AsciinemaWidget:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("AsciinemaWidget",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"verify-the-cli",children:"Verify the CLI"})}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsx)(s.p,{children:"This recording presents the essence of this page. It's recommended to read it in full for the motivation and all details."})}),"\n",(0,i.jsx)(n,{src:"/constellation/assets/verify-cli.cast",rows:"20",cols:"112",idleTimeLimit:"3",preload:"true",theme:"edgeless"}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:["Edgeless Systems uses ",(0,i.jsx)(s.a,{href:"https://www.sigstore.dev/",children:"sigstore"})," and ",(0,i.jsx)(s.a,{href:"https://slsa.dev",children:"SLSA"}),' to ensure supply-chain security for the Constellation CLI and node images ("artifacts"). sigstore consists of three components: ',(0,i.jsx)(s.a,{href:"https://docs.sigstore.dev/cosign/signing/overview/",children:"Cosign"}),", ",(0,i.jsx)(s.a,{href:"https://docs.sigstore.dev/logging/overview",children:"Rekor"}),", and Fulcio. Edgeless Systems uses Cosign to sign artifacts. All signatures are uploaded to the public Rekor transparency log, which resides at ",(0,i.jsx)(s.code,{children:"https://rekor.sigstore.dev"}),"."]}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"The public key for Edgeless Systems' long-term code-signing key is:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEf8F1hpmwE+YCFXzjGtaQcrL6XZVT\nJmEe5iSLvG1SyQSAew7WdMKF6o9t8e2TFuCkzlOhhlws2OHWbiFZnFWCFw==\n-----END PUBLIC KEY-----\n"})}),(0,i.jsxs)(s.p,{children:["The public key is also available for download at ",(0,i.jsx)(s.a,{href:"https://edgeless.systems/es.pub",children:"https://edgeless.systems/es.pub"})," and in the Twitter profile ",(0,i.jsx)(s.a,{href:"https://twitter.com/EdgelessSystems",children:"@EdgelessSystems"}),"."]})]}),"\n",(0,i.jsx)(s.p,{children:"The Rekor transparency log is a public append-only ledger that verifies and records signatures and associated metadata. The Rekor transparency log enables everyone to observe the sequence of (software) signatures issued by Edgeless Systems and many other parties. The transparency log allows for the public identification of dubious or malicious signatures."}),"\n",(0,i.jsx)(s.p,{children:"You should always ensure that (1) your CLI executable was signed with the private key corresponding to the above public key and that (2) there is a corresponding entry in the Rekor transparency log. Both can be done as described in the following."}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsx)(s.p,{children:"You don't need to verify the Constellation node images. This is done automatically by your CLI and the rest of Constellation."})}),"\n",(0,i.jsx)(s.h2,{id:"verify-the-signature",children:"Verify the signature"}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsx)(s.p,{children:"This guide assumes Linux on an amd64 processor. The exact steps for other platforms differ slightly."})}),"\n",(0,i.jsxs)(s.p,{children:["First, ",(0,i.jsx)(s.a,{href:"https://docs.sigstore.dev/cosign/system_config/installation/",children:"install the Cosign CLI"}),". Next, ",(0,i.jsx)(s.a,{href:"https://github.com/edgelesssys/constellation/releases",children:"download"})," and verify the signature that accompanies your CLI executable, for example:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell-session",children:"$ cosign verify-blob --key https://edgeless.systems/es.pub --signature constellation-linux-amd64.sig constellation-linux-amd64\n\nVerified OK\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The above performs an offline verification of the provided public key, signature, and executable. To also verify that a corresponding entry exists in the public Rekor transparency log, add the variable ",(0,i.jsx)(s.code,{children:"COSIGN_EXPERIMENTAL=1"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell-session",children:"$ COSIGN_EXPERIMENTAL=1 cosign verify-blob --key https://edgeless.systems/es.pub --signature constellation-linux-amd64.sig constellation-linux-amd64\n\ntlog entry verified with uuid: afaba7f6635b3e058888692841848e5514357315be9528474b23f5dcccb82b13 index: 3477047\nVerified OK\n"})}),"\n",(0,i.jsx)(s.p,{children:"\ud83c\udfc1 You now know that your CLI executable was officially released and signed by Edgeless Systems."}),"\n",(0,i.jsx)(s.h3,{id:"optional-manually-inspect-the-transparency-log",children:"Optional: Manually inspect the transparency log"}),"\n",(0,i.jsxs)(s.p,{children:["To further inspect the public Rekor transparency log, ",(0,i.jsx)(s.a,{href:"https://docs.sigstore.dev/logging/installation",children:"install the Rekor CLI"}),". A search for the CLI executable  should give a single UUID. (Note that this UUID contains the UUID from the previous ",(0,i.jsx)(s.code,{children:"cosign"})," command.)"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell-session",children:"$ rekor-cli search --artifact constellation-linux-amd64\n\nFound matching entries (listed by UUID):\n362f8ecba72f4326afaba7f6635b3e058888692841848e5514357315be9528474b23f5dcccb82b13\n"})}),"\n",(0,i.jsx)(s.p,{children:"With this UUID you can get the full entry from the transparency log:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell-session",children:'$ rekor-cli get --uuid=362f8ecba72f4326afaba7f6635b3e058888692841848e5514357315be9528474b23f5dcccb82b13\n\nLogID: c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d\nIndex: 3477047\nIntegratedTime: 2022-09-12T22:28:16Z\nUUID: afaba7f6635b3e058888692841848e5514357315be9528474b23f5dcccb82b13\nBody: {\n  "HashedRekordObj": {\n    "data": {\n      "hash": {\n        "algorithm": "sha256",\n        "value": "40e137b9b9b8204d672642fd1e181c6d5ccb50cfc5cc7fcbb06a8c2c78f44aff"\n      }\n    },\n    "signature": {\n      "content": "MEUCIQCSER3mGj+j5Pr2kOXTlCIHQC3gT30I7qkLr9Awt6eUUQIgcLUKRIlY50UN8JGwVeNgkBZyYD8HMxwC/LFRWoMn180=",\n      "publicKey": {\n        "content": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZjhGMWhwbXdFK1lDRlh6akd0YVFjckw2WFpWVApKbUVlNWlTTHZHMVN5UVNBZXc3V2RNS0Y2bzl0OGUyVEZ1Q2t6bE9oaGx3czJPSFdiaUZabkZXQ0Z3PT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(s.p,{children:["The field ",(0,i.jsx)(s.code,{children:"publicKey"})," should contain Edgeless Systems' public key in Base64 encoding."]}),"\n",(0,i.jsx)(s.p,{children:"You can get an exhaustive list of artifact signatures issued by Edgeless Systems via the following command:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"rekor-cli search --public-key https://edgeless.systems/es.pub --pki-format x509\n"})}),"\n",(0,i.jsx)(s.p,{children:"Edgeless Systems monitors this list to detect potential unauthorized use of its private key."}),"\n",(0,i.jsx)(s.h2,{id:"verify-the-provenance",children:"Verify the provenance"}),"\n",(0,i.jsxs)(s.p,{children:["Provenance attests that a software artifact was produced by a specific repository and build system invocation. For more information on provenance visit ",(0,i.jsx)(s.a,{href:"https://slsa.dev/provenance/v0.2",children:"slsa.dev"})," and learn about the ",(0,i.jsx)(s.a,{href:"/constellation/2.22/reference/slsa",children:"adoption of SLSA for Constellation"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Just as checking its signature proves that the CLI hasn't been manipulated, checking the provenance proves that the artifact was produced by the expected build process and hasn't been tampered with."}),"\n",(0,i.jsxs)(s.p,{children:["To verify the provenance, first install the ",(0,i.jsx)(s.a,{href:"https://github.com/slsa-framework/slsa-verifier",children:"slsa-verifier"}),". Then make sure you have the provenance file (",(0,i.jsx)(s.code,{children:"constellation.intoto.jsonl"}),") and Constellation CLI downloaded. Both are available on the ",(0,i.jsx)(s.a,{href:"https://github.com/edgelesssys/constellation/releases",children:"GitHub release page"}),"."]}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsx)(s.p,{children:"The same provenance file is valid for all Constellation CLI executables of a given version independent of the target platform."})}),"\n",(0,i.jsx)(s.p,{children:"Use the verifier to perform the check:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-shell-session",children:"$ slsa-verifier verify-artifact constellation-linux-amd64 \\\n  --provenance-path constellation.intoto.jsonl \\\n  --source-uri github.com/edgelesssys/constellation\n\nVerified signature against tlog entry index 7771317 at URL: https://rekor.sigstore.dev/api/v1/log/entries/24296fb24b8ad77af2c04c8b4ae0d5bc5...\nVerified build using builder https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v1.2.2 at commit 18e9924b416323c37b9cdfd6cc728de8a947424a\nPASSED: Verified SLSA provenance\n"})})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>a});var t=n(96540);const i={},o=t.createContext(i);function r(e){const s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);