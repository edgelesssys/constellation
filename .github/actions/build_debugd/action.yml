name: Build debugd
description: Build the Constellation debugd binary

inputs:
  outputPath:
    description: 'Output path of the binary'
    default: './debugd'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Install Go
      uses: actions/setup-go@84cbf8094393cdc5fe1fe1671ff2647332956b1a
      with:
        go-version: "1.18"

    - name: Install Dependencies
      shell: bash
      run: sudo apt-get update && sudo apt-get -y install cmake make
    
    - name: Build debugd
      shell: bash
      run: |
        homedir="$(getent passwd $(id -u) | cut -d ":" -f 6)"
        mkdir -p build && cd build
        cmake ..
        export GOCACHE=${homedir}/.cache/go-build
        export GOPATH=${homedir}/go
        export GOPRIVATE=github.com/edgelesssys
        export GOMODCACHE=${homedir}/.cache/go-mod
        make debugd cdbg
        mv -n debugd "${{ inputs.outputPath }}"
