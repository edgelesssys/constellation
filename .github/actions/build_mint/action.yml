name: Build mint container
description: "Build and upload the mint container used during s3proxy e2e tests."

inputs:
  version:
    description: "Version to use for the new mint image"
    required: true
  username:
    description: "Username to use for logging in to the container registry"
    required: true
  password:
    description: "Password to use for logging in to the container registry"
    required: true

outputs:
  mintImage:
    description: "Name and tag of the image that was built and pushed"
    value: ghcr.io/edgelesssys/constellation/mint:${{ inputs.version }}

runs:
  using: "composite"
  steps:
    - name: Log in to the Container registry
      uses: ./.github/actions/container_registry_login
      with:
        registry: ghcr.io
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}

    - name: Build and push container image
      uses: docker/build-push-action@2eb1c1961a95fc15694676618e422e8ba1d63825 # v4.1.1
      with:
        context: ./s3proxy/e2e/mint
        file: ./s3proxy/e2e/mint/Dockerfile
        push: true
        tags: |
          ghcr.io/edgelesssys/constellation/mint:${{ inputs.version }}
