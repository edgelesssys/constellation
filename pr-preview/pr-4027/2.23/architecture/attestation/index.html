<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.23 docs-doc-page docs-doc-id-architecture/attestation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Attestation | Constellation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.edgeless.systems/constellation/2.23/architecture/attestation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.23"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.23"><meta data-rh="true" name="docsearch:version" content="2.23"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.23"><meta data-rh="true" property="og:title" content="Attestation | Constellation"><meta data-rh="true" name="description" content="This page explains Constellation&#x27;s attestation process and highlights the cornerstones of its trust model."><meta data-rh="true" property="og:description" content="This page explains Constellation&#x27;s attestation process and highlights the cornerstones of its trust model."><link data-rh="true" rel="icon" href="/constellation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.edgeless.systems/constellation/2.23/architecture/attestation"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/constellation/2.23/architecture/attestation" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.edgeless.systems/constellation/2.23/architecture/attestation" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Architecture","item":"https://docs.edgeless.systems/constellation/2.23/category/architecture"},{"@type":"ListItem","position":2,"name":"Attestation","item":"https://docs.edgeless.systems/constellation/2.23/architecture/attestation"}]}</script><script src="/constellation/gtagman.js" async data-cookieconsent="ignore"></script><link rel="stylesheet" href="/constellation/assets/css/styles.9ca3c5b3.css">
<script src="/constellation/assets/js/runtime~main.87c4c513.js" defer="defer"></script>
<script src="/constellation/assets/js/main.add27954.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#E7E6E6" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you like Constellation, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/edgelesssys/constellation">GitHub</a> ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/constellation/"><div class="navbar__logo"><img src="/constellation/img/logos/constellation_oneline.svg" alt="Constellation Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/constellation/img/logos/constellation_oneline.svg" alt="Constellation Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/constellation/2.23/architecture/attestation">2.23</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/constellation/next/architecture/attestation">Next</a></li><li><a class="dropdown__link" href="/constellation/architecture/attestation">2.24</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/constellation/2.23/architecture/attestation">2.23</a></li><li><a class="dropdown__link" href="/constellation/2.22/architecture/attestation">2.22</a></li></ul></div><a href="https://github.com/edgelesssys/constellation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-2.23"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/constellation/2.23/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/constellation/2.23/category/basics"><span title="Basics" class="categoryLinkLabel_W154">Basics</span></a><button aria-label="Expand sidebar category &#x27;Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/constellation/2.23/category/getting-started"><span title="Getting started" class="categoryLinkLabel_W154">Getting started</span></a><button aria-label="Expand sidebar category &#x27;Getting started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/constellation/2.23/category/workflows"><span title="Workflows" class="categoryLinkLabel_W154">Workflows</span></a><button aria-label="Expand sidebar category &#x27;Workflows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/constellation/2.23/category/architecture"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/orchestration"><span title="Cluster orchestration" class="linkLabel_WmDU">Cluster orchestration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/versions"><span title="Versions and support" class="linkLabel_WmDU">Versions and support</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/microservices"><span title="Microservices" class="linkLabel_WmDU">Microservices</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/constellation/2.23/architecture/attestation"><span title="Attestation" class="linkLabel_WmDU">Attestation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/images"><span title="Images" class="linkLabel_WmDU">Images</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/keys"><span title="Keys and cryptographic primitives" class="linkLabel_WmDU">Keys and cryptographic primitives</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/encrypted-storage"><span title="Encrypted persistent storage" class="linkLabel_WmDU">Encrypted persistent storage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/networking"><span title="Networking" class="linkLabel_WmDU">Networking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/constellation/2.23/architecture/observability"><span title="Observability" class="linkLabel_WmDU">Observability</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/constellation/2.23/category/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Constellation<!-- --> <b>2.23</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/constellation/architecture/attestation">latest version</a></b> (<!-- -->2.24<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/constellation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/constellation/2.23/category/architecture"><span>Architecture</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Attestation</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.23</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Attestation</h1></header>
<p>This page explains Constellation&#x27;s attestation process and highlights the cornerstones of its trust model.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="terms">Terms<a href="#terms" class="hash-link" aria-label="Direct link to Terms" title="Direct link to Terms" translate="no">​</a></h2>
<p>The following lists terms and concepts that help to understand the attestation concept of Constellation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="trusted-platform-module-tpm">Trusted Platform Module (TPM)<a href="#trusted-platform-module-tpm" class="hash-link" aria-label="Direct link to Trusted Platform Module (TPM)" title="Direct link to Trusted Platform Module (TPM)" translate="no">​</a></h3>
<p>A TPM chip is a dedicated tamper-resistant crypto-processor.
It can securely store artifacts such as passwords, certificates, encryption keys, or <em>runtime measurements</em> (more on this below).
When a TPM is implemented in software, it&#x27;s typically called a <em>virtual</em> TPM (vTPM).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-measurement">Runtime measurement<a href="#runtime-measurement" class="hash-link" aria-label="Direct link to Runtime measurement" title="Direct link to Runtime measurement" translate="no">​</a></h3>
<p>A runtime measurement is a cryptographic hash of the memory pages of a so called <em>runtime component</em>. Runtime components of interest typically include a system&#x27;s bootloader or OS kernel.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="platform-configuration-register-pcr">Platform Configuration Register (PCR)<a href="#platform-configuration-register-pcr" class="hash-link" aria-label="Direct link to Platform Configuration Register (PCR)" title="Direct link to Platform Configuration Register (PCR)" translate="no">​</a></h3>
<p>A Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties.
To store a new value in a PCR, the existing value is extended with a new value as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PCR[N] = HASHalg( PCR[N] || ArgumentOfExtend )</span><br></span></code></pre></div></div>
<p>The PCRs are typically used to store runtime measurements.
The new value of a PCR is always an extension of the existing value.
Thus, storing the measurements of multiple components into the same PCR irreversibly links them together.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="measured-boot">Measured boot<a href="#measured-boot" class="hash-link" aria-label="Direct link to Measured boot" title="Direct link to Measured boot" translate="no">​</a></h3>
<p>Measured boot builds on the concept of chained runtime measurements.
Each component in the boot chain loads and measures the next component into the PCR before executing it.
By comparing the resulting PCR values against trusted reference values, the integrity of the entire boot chain and thereby the running system can be ensured.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remote-attestation-ra">Remote attestation (RA)<a href="#remote-attestation-ra" class="hash-link" aria-label="Direct link to Remote attestation (RA)" title="Direct link to Remote attestation (RA)" translate="no">​</a></h3>
<p>Remote attestation is the process of verifying certain properties of an application or platform, such as integrity and confidentiality, from a remote location.
In the case of a measured boot, the goal is to obtain a signed attestation statement on the PCR values of the boot measurements.
The statement can then be verified and compared to a set of trusted reference values.
This way, the integrity of the platform can be ensured before sharing secrets with it.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="confidential-virtual-machine-cvm">Confidential virtual machine (CVM)<a href="#confidential-virtual-machine-cvm" class="hash-link" aria-label="Direct link to Confidential virtual machine (CVM)" title="Direct link to Confidential virtual machine (CVM)" translate="no">​</a></h3>
<p>Confidential computing (CC) is the protection of data in-use with hardware-based trusted execution environments (TEEs).
With CVMs, TEEs encapsulate entire virtual machines and isolate them against the hypervisor, other VMs, and direct memory access.
After loading the initial VM image into encrypted memory, the hypervisor calls for a secure processor to measure these initial memory pages.
The secure processor locks these pages and generates an attestation report on the initial page measurements.
CVM memory pages are encrypted with a key that resides inside the secure processor, which makes sure only the guest VM can access them.
The attestation report is signed by the secure processor and can be verified using remote attestation via the certificate authority of the hardware vendor.
Such an attestation statement guarantees the confidentiality and integrity of a CVM.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="attested-tls-atls">Attested TLS (aTLS)<a href="#attested-tls-atls" class="hash-link" aria-label="Direct link to Attested TLS (aTLS)" title="Direct link to Attested TLS (aTLS)" translate="no">​</a></h3>
<p>In a CC environment, attested TLS (aTLS) can be used to establish secure connections between two parties using the remote attestation features of the CC components.</p>
<p>aTLS modifies the TLS handshake by embedding an attestation statement into the TLS certificate.
Instead of relying on a certificate authority, aTLS uses this attestation statement to establish trust in the certificate.</p>
<p>The protocol can be used by clients to verify a server certificate, by a server to verify a client certificate, or for mutual verification (mutual aTLS).</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The challenge for Constellation is to lift a CVM&#x27;s attestation statement to the Kubernetes software layer and make it end-to-end verifiable.
From there, Constellation needs to expand the attestation from a single CVM to the entire cluster.</p>
<p>The <a class="" href="/constellation/2.23/architecture/microservices#joinservice"><em>JoinService</em></a> and <a class="" href="/constellation/2.23/architecture/microservices#verificationservice"><em>VerificationService</em></a> are where all runs together.
Internally, the <em>JoinService</em> uses remote attestation to securely join CVM nodes to the cluster.
Externally, the <em>VerificationService</em> provides an attestation statement for the cluster&#x27;s CVMs and configuration.</p>
<p>The following explains the details of both steps.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-attestation">Node attestation<a href="#node-attestation" class="hash-link" aria-label="Direct link to Node attestation" title="Direct link to Node attestation" translate="no">​</a></h2>
<p>The idea is that Constellation nodes should have verifiable integrity from the CVM hardware measurement up to the Kubernetes software layer.
The solution is a verifiable boot chain and an integrity-protected runtime environment.</p>
<p>Constellation uses measured boot within CVMs, measuring each component in the boot process before executing it.
Outside of CC, this is usually implemented via TPMs.
CVM technologies differ in how they implement runtime measurements, but the general concepts are similar to those of a TPM.
For simplicity, TPM terminology like <em>PCR</em> is used in the following.</p>
<p>When a Constellation node image boots inside a CVM, measured boot is used for all stages and components of the boot chain.
This process goes up to the root filesystem.
The root filesystem is mounted read-only with integrity protection.
For the details on the image and boot stages see the <a class="" href="/constellation/2.23/architecture/images">image architecture</a> documentation.
Any changes to the image will inevitably also change the corresponding PCR values.
To create a node attestation statement, the Constellation image obtains a CVM attestation statement from the hardware.
This includes the runtime measurements and thereby binds the measured boot results to the CVM hardware measurement.</p>
<p>In addition to the image measurements, Constellation extends a PCR during the <a class="" href="/constellation/2.23/workflows/create">initialization phase</a> that irrevocably marks the node as initialized.
The measurement is created using the <a class="" href="/constellation/2.23/architecture/keys#cluster-identity"><em>clusterID</em></a>, tying all future attestation statements to this ID.
Thereby, an attestation statement is unique for every cluster and a node can be identified unambiguously as being initialized.</p>
<p>To verify an attestation, the hardware&#x27;s signature and a statement are verified first to establish trust in the contained runtime measurements.
If successful, the measurements are verified against the trusted values of the particular Constellation release version.
Finally, the measurement of the <em>clusterID</em> can be compared by calculating it with the <a class="" href="/constellation/2.23/architecture/keys#master-secret">master secret</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-measurements">Runtime measurements<a href="#runtime-measurements" class="hash-link" aria-label="Direct link to Runtime measurements" title="Direct link to Runtime measurements" translate="no">​</a></h3>
<p>Constellation uses runtime measurements to implement the measured boot approach.
As stated above, the underlying hardware technology and guest firmware differ in their implementations of runtime measurements.
The following gives a detailed description of the available measurements in the different cloud environments.</p>
<p>The runtime measurements consist of two types of values:</p>
<ul>
<li class="">
<p><strong>Measurements produced by the cloud infrastructure and firmware of the CVM</strong>:
These are measurements of closed-source firmware and other values controlled by the cloud provider.
While not being reproducible for the user, some of them can be compared against previously observed values.
Others may change frequently and aren&#x27;t suitable for verification.
The <a href="#chain-of-trust" class="">signed image measurements</a> include measurements that are known, previously observed values.</p>
</li>
<li class="">
<p><strong>Measurements produced by the Constellation bootloader and boot chain</strong>:
The Constellation Bootloader takes over from the CVM firmware and <a class="" href="/constellation/2.23/architecture/images">measures the rest of the boot chain</a>.
The Constellation <a class="" href="/constellation/2.23/architecture/microservices#bootstrapper">Bootstrapper</a> is the first user mode component that runs in a Constellation image.
It extends PCR registers with the <a class="" href="/constellation/2.23/architecture/keys#cluster-identity">IDs</a> of the cluster marking a node as initialized.</p>
</li>
</ul>
<p>Constellation allows to specify in the config which measurements should be enforced during the attestation process.
Enforcing non-reproducible measurements controlled by the cloud provider means that changes in these values require manual updates to the cluster&#x27;s config.
By default, Constellation only enforces measurements that are stable values produced by the infrastructure or by Constellation directly.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Azure</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">GCP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">STACKIT</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Constellation uses the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nitrotpm.html" target="_blank" rel="noopener noreferrer" class="">vTPM</a> (NitroTPM) feature of the <a href="http://aws.amazon.com/ec2/nitro/" target="_blank" rel="noopener noreferrer" class="">AWS Nitro System</a> on AWS for runtime measurements.</p><p>The vTPM adheres to the <a href="https://trustedcomputinggroup.org/resource/tpm-library-specification/" target="_blank" rel="noopener noreferrer" class="">TPM 2.0</a> specification.
The VMs are attested by obtaining signed PCR values over the VM&#x27;s boot configuration from the TPM and comparing them to a known, good state (measured boot).</p><p>The following table lists all PCR values of the vTPM and the measured components.
It also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.
The latter means that the value can be generated offline and compared to the one in the vTPM.</p><table><thead><tr><th>PCR</th><th>Components</th><th>Measured by</th><th>Reproducible and verifiable</th></tr></thead><tbody><tr><td>0</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>1</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>2</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>3</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>4</td><td>Constellation Bootloader, Kernel, initramfs, Kernel command line</td><td>AWS, Constellation Bootloader</td><td>Yes</td></tr><tr><td>5</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>6</td><td>Firmware</td><td>AWS</td><td>No</td></tr><tr><td>7</td><td>Secure Boot Policy</td><td>AWS, Constellation Bootloader</td><td>No</td></tr><tr><td>8</td><td>-</td><td>-</td><td>-</td></tr><tr><td>9</td><td>initramfs, Kernel command line</td><td>Linux Kernel</td><td>Yes</td></tr><tr><td>10</td><td>User space</td><td>Linux IMA</td><td>No<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_Vzrq">1</a></sup></td></tr><tr><td>11</td><td>Unified Kernel Image components</td><td>Constellation Bootloader</td><td>Yes</td></tr><tr><td>12</td><td>Reserved</td><td>(User space, Constellation Bootloader)</td><td>Yes</td></tr><tr><td>13</td><td>Reserved</td><td>(Constellation Bootloader)</td><td>Yes</td></tr><tr><td>14</td><td>Secure Boot State</td><td>Constellation Bootloader</td><td>No</td></tr><tr><td>15</td><td>ClusterID</td><td>Constellation Bootstrapper</td><td>Yes</td></tr><tr><td>16–23</td><td>Unused</td><td>-</td><td>-</td></tr></tbody></table></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Constellation uses the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch#vtpm" target="_blank" rel="noopener noreferrer" class="">vTPM</a> feature of Azure CVMs for runtime measurements.
This vTPM adheres to the <a href="https://trustedcomputinggroup.org/resource/tpm-library-specification/" target="_blank" rel="noopener noreferrer" class="">TPM 2.0</a> specification.
It provides a <a href="https://docs.microsoft.com/en-us/azure/security/fundamentals/measured-boot-host-attestation#measured-boot" target="_blank" rel="noopener noreferrer" class="">measured boot</a> verification that&#x27;s based on the trusted launch feature of <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch" target="_blank" rel="noopener noreferrer" class="">Trusted Launch VMs</a>.</p><p>The following table lists all PCR values of the vTPM and the measured components.
It also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.
The latter means that the value can be generated offline and compared to the one in the vTPM.</p><table><thead><tr><th>PCR</th><th>Components</th><th>Measured by</th><th>Reproducible and verifiable</th></tr></thead><tbody><tr><td>0</td><td>Firmware</td><td>Azure</td><td>No</td></tr><tr><td>1</td><td>Firmware</td><td>Azure</td><td>No</td></tr><tr><td>2</td><td>Firmware</td><td>Azure</td><td>No</td></tr><tr><td>3</td><td>Firmware</td><td>Azure</td><td>No</td></tr><tr><td>4</td><td>Constellation Bootloader, Kernel, initramfs, Kernel command line</td><td>Azure, Constellation Bootloader</td><td>Yes</td></tr><tr><td>5</td><td>Reserved</td><td>Azure</td><td>No</td></tr><tr><td>6</td><td>VM Unique ID</td><td>Azure</td><td>No</td></tr><tr><td>7</td><td>Secure Boot State</td><td>Azure, Constellation Bootloader</td><td>No</td></tr><tr><td>8</td><td>-</td><td>-</td><td>-</td></tr><tr><td>9</td><td>initramfs, Kernel command line</td><td>Linux Kernel</td><td>Yes</td></tr><tr><td>10</td><td>User space</td><td>Linux IMA</td><td>No<sup><a href="#user-content-fn-1" id="user-content-fnref-1-2" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_Vzrq">1</a></sup></td></tr><tr><td>11</td><td>Unified Kernel Image components</td><td>Constellation Bootloader</td><td>Yes</td></tr><tr><td>12</td><td>Reserved</td><td>(User space, Constellation Bootloader)</td><td>Yes</td></tr><tr><td>13</td><td>Reserved</td><td>(Constellation Bootloader)</td><td>Yes</td></tr><tr><td>14</td><td>Secure Boot State</td><td>Constellation Bootloader</td><td>No</td></tr><tr><td>15</td><td>ClusterID</td><td>Constellation Bootstrapper</td><td>Yes</td></tr><tr><td>16–23</td><td>Unused</td><td>-</td><td>-</td></tr></tbody></table></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Constellation uses the <a href="https://cloud.google.com/compute/confidential-vm/docs/about-cvm" target="_blank" rel="noopener noreferrer" class="">vTPM</a> feature of CVMs on GCP for runtime measurements.
Note that this vTPM doesn&#x27;t run inside the hardware-protected CVM context, but is emulated by the hypervisor.</p><p>The vTPM adheres to the <a href="https://trustedcomputinggroup.org/resource/tpm-library-specification/" target="_blank" rel="noopener noreferrer" class="">TPM 2.0</a> specification.
It provides a <a href="https://cloud.google.com/compute/confidential-vm/docs/monitoring#about_launch_attestation_report_events" target="_blank" rel="noopener noreferrer" class="">launch attestation report</a> that&#x27;s based on the measured boot feature of <a href="https://cloud.google.com/compute/shielded-vm/docs/shielded-vm#measured-boot" target="_blank" rel="noopener noreferrer" class="">Shielded VMs</a>.</p><p>The following table lists all PCR values of the vTPM and the measured components.
It also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.
The latter means that the value can be generated offline and compared to the one in the vTPM.</p><table><thead><tr><th>PCR</th><th>Components</th><th>Measured by</th><th>Reproducible and verifiable</th></tr></thead><tbody><tr><td>0</td><td>CVM version and technology</td><td>GCP</td><td>No</td></tr><tr><td>1</td><td>Firmware</td><td>GCP</td><td>No</td></tr><tr><td>2</td><td>Firmware</td><td>GCP</td><td>No</td></tr><tr><td>3</td><td>Firmware</td><td>GCP</td><td>No</td></tr><tr><td>4</td><td>Constellation Bootloader, Kernel, initramfs, Kernel command line</td><td>GCP, Constellation Bootloader</td><td>Yes</td></tr><tr><td>5</td><td>Disk GUID partition table</td><td>GCP</td><td>No</td></tr><tr><td>6</td><td>Disk GUID partition table</td><td>GCP</td><td>No</td></tr><tr><td>7</td><td>GCP Secure Boot Policy</td><td>GCP, Constellation Bootloader</td><td>No</td></tr><tr><td>8</td><td>-</td><td>-</td><td>-</td></tr><tr><td>9</td><td>initramfs, Kernel command line</td><td>Linux Kernel</td><td>Yes</td></tr><tr><td>10</td><td>User space</td><td>Linux IMA</td><td>No<sup><a href="#user-content-fn-1" id="user-content-fnref-1-3" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_Vzrq">1</a></sup></td></tr><tr><td>11</td><td>Unified Kernel Image components</td><td>Constellation Bootloader</td><td>Yes</td></tr><tr><td>12</td><td>Reserved</td><td>(User space, Constellation Bootloader)</td><td>Yes</td></tr><tr><td>13</td><td>Reserved</td><td>(Constellation Bootloader)</td><td>Yes</td></tr><tr><td>14</td><td>Secure Boot State</td><td>Constellation Bootloader</td><td>No</td></tr><tr><td>15</td><td>ClusterID</td><td>Constellation Bootstrapper</td><td>Yes</td></tr><tr><td>16–23</td><td>Unused</td><td>-</td><td>-</td></tr></tbody></table></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Constellation uses a hypervisor-based vTPM for runtime measurements.</p><p>The vTPM adheres to the <a href="https://trustedcomputinggroup.org/resource/tpm-library-specification/" target="_blank" rel="noopener noreferrer" class="">TPM 2.0</a> specification.
The VMs are attested by obtaining signed PCR values over the VM&#x27;s boot configuration from the TPM and comparing them to a known, good state (measured boot).</p><p>The following table lists all PCR values of the vTPM and the measured components.
It also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.
The latter means that the value can be generated offline and compared to the one in the vTPM.</p><table><thead><tr><th>PCR</th><th>Components</th><th>Measured by</th><th>Reproducible and verifiable</th></tr></thead><tbody><tr><td>0</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>1</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>2</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>3</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>4</td><td>Constellation Bootloader, Kernel, initramfs, Kernel command line</td><td>STACKIT, Constellation Bootloader</td><td>Yes</td></tr><tr><td>5</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>6</td><td>Firmware</td><td>STACKIT</td><td>No</td></tr><tr><td>7</td><td>Secure Boot Policy</td><td>STACKIT, Constellation Bootloader</td><td>No</td></tr><tr><td>8</td><td>-</td><td>-</td><td>-</td></tr><tr><td>9</td><td>initramfs, Kernel command line</td><td>Linux Kernel</td><td>Yes</td></tr><tr><td>10</td><td>User space</td><td>Linux IMA</td><td>No<sup><a href="#user-content-fn-1" id="user-content-fnref-1-4" data-footnote-ref="true" aria-describedby="footnote-label" class="anchorTargetStickyNavbar_Vzrq">1</a></sup></td></tr><tr><td>11</td><td>Unified Kernel Image components</td><td>Constellation Bootloader</td><td>Yes</td></tr><tr><td>12</td><td>Reserved</td><td>(User space, Constellation Bootloader)</td><td>Yes</td></tr><tr><td>13</td><td>Reserved</td><td>(Constellation Bootloader)</td><td>Yes</td></tr><tr><td>14</td><td>Secure Boot State</td><td>Constellation Bootloader</td><td>No</td></tr><tr><td>15</td><td>ClusterID</td><td>Constellation Bootstrapper</td><td>Yes</td></tr><tr><td>16–23</td><td>Unused</td><td>-</td><td>-</td></tr></tbody></table></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cvm-verification">CVM verification<a href="#cvm-verification" class="hash-link" aria-label="Direct link to CVM verification" title="Direct link to CVM verification" translate="no">​</a></h3>
<p>To verify the integrity of the received attestation statement, a chain of trust from the CVM technology to the interface providing the statement has to be established.
For verification of the CVM technology, Constellation may expose additional options in its config file.</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">AWS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Azure SEV-SNP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">GCP</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">STACKIT</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>On AWS, AMD SEV-SNP is used to provide runtime encryption to the VMs.
An SEV-SNP attestation report is used to establish trust in the VM.
You may customize certain parameters for verification of the attestation statement using the Constellation config file.</p><ul>
<li class="">
<p>TCB versions</p>
<p>You can set the minimum version numbers of components in the SEV-SNP TCB.
Use the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.
Alternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster.</p>
</li>
<li class="">
<p>AMD Root Key Certificate</p>
<p>This certificate is the root of trust for verifying the SEV-SNP certificate chain.</p>
</li>
<li class="">
<p>AMD Signing Key Certificate</p>
<p>This is the intermediate certificate for verifying the SEV-SNP report&#x27;s signature.
If it&#x27;s not specified, the CLI fetches it from the AMD key distribution server.</p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>On Azure, AMD SEV-SNP is used to provide runtime encryption to the VMs.
An SEV-SNP attestation report is used to establish trust in the vTPM running inside the VM.
You may customize certain parameters for verification of the attestation statement using the Constellation config file.</p><ul>
<li class="">
<p>TCB versions</p>
<p>You can set the minimum version numbers of components in the SEV-SNP TCB.
Use the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.
Alternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster.</p>
</li>
<li class="">
<p>AMD Root Key Certificate</p>
<p>This certificate is the root of trust for verifying the SEV-SNP certificate chain.</p>
</li>
<li class="">
<p>Firmware Signer</p>
<p>This config option allows you to specify how the firmware signer should be verified.
More explicitly, it controls the verification of the <code>IDKeyDigest</code> value in the SEV-SNP attestation report.
You can provide a list of accepted key digests and specify a policy on how this list is compared against the reported <code>IDKeyDigest</code>.</p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>On GCP, AMD SEV-SNP is used to provide runtime encryption to the VMs.
An SEV-SNP attestation report is used to establish trust in the VM.
You may customize certain parameters for verification of the attestation statement using the Constellation config file.</p><ul>
<li class="">
<p>TCB versions</p>
<p>You can set the minimum version numbers of components in the SEV-SNP TCB.
Use the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.
Alternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster.</p>
</li>
<li class="">
<p>AMD Root Key Certificate</p>
<p>This certificate is the root of trust for verifying the SEV-SNP certificate chain.</p>
</li>
<li class="">
<p>AMD Signing Key Certificate</p>
<p>This is the intermediate certificate for verifying the SEV-SNP report&#x27;s signature.
If it&#x27;s not specified, the CLI fetches it from the AMD key distribution server.</p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>On STACKIT, AMD SEV-ES is used to provide runtime encryption to the VMs.
The hypervisor-based vTPM is used to establish trust in the VM via <a href="#runtime-measurements" class="">runtime measurements</a>.
There is no additional configuration available for STACKIT.</p></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="cluster-attestation">Cluster attestation<a href="#cluster-attestation" class="hash-link" aria-label="Direct link to Cluster attestation" title="Direct link to Cluster attestation" translate="no">​</a></h2>
<p>Cluster-facing, Constellation&#x27;s <a class="" href="/constellation/2.23/architecture/microservices#joinservice"><em>JoinService</em></a> verifies each node joining the cluster given the configured ground truth runtime measurements.
User-facing, the <a class="" href="/constellation/2.23/architecture/microservices#verificationservice"><em>VerificationService</em></a> provides an interface to verify a node using remote attestation.
By verifying the first node during the <a class="" href="/constellation/2.23/architecture/microservices#bootstrapper">initialization</a> and configuring the ground truth measurements that are subsequently enforced by the <em>JoinService</em>, the whole cluster is verified in a transitive way.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cluster-facing-attestation">Cluster-facing attestation<a href="#cluster-facing-attestation" class="hash-link" aria-label="Direct link to Cluster-facing attestation" title="Direct link to Cluster-facing attestation" translate="no">​</a></h3>
<p>The <em>JoinService</em> is provided with the runtime measurements of the whitelisted Constellation image version as the ground truth.
During the initialization and the cluster bootstrapping, each node connects to the <em>JoinService</em> using <a href="#attested-tls-atls" class="">aTLS</a>.
During the handshake, the node transmits an attestation statement including its runtime measurements.
The <em>JoinService</em> verifies that statement and compares the measurements against the ground truth.
For details of the initialization process check the <a class="" href="/constellation/2.23/architecture/microservices">microservice descriptions</a>.</p>
<p>After the initialization, every node updates its runtime measurements with the <em>clusterID</em> value, marking it irreversibly as initialized.
When an initialized node tries to join another cluster, its measurements inevitably mismatch the measurements of an uninitialized node and it will be declined.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-facing-attestation">User-facing attestation<a href="#user-facing-attestation" class="hash-link" aria-label="Direct link to User-facing attestation" title="Direct link to User-facing attestation" translate="no">​</a></h3>
<p>The <a class="" href="/constellation/2.23/architecture/microservices#verificationservice"><em>VerificationService</em></a> provides an endpoint for obtaining its hardware-based remote attestation statement, which includes the runtime measurements.
A user can <a class="" href="/constellation/2.23/workflows/verify-cluster">verify</a> this statement and compare the measurements against the configured ground truth and, thus, verify the identity and integrity of all Constellation components and the cluster configuration. Subsequently, the user knows that the entire cluster is in the expected state and is trustworthy.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="putting-it-all-together">Putting it all together<a href="#putting-it-all-together" class="hash-link" aria-label="Direct link to Putting it all together" title="Direct link to Putting it all together" translate="no">​</a></h2>
<p>This section puts the aforementioned concepts together and illustrate how trust into a Constellation cluster is established and maintained.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cli-and-node-images">CLI and node images<a href="#cli-and-node-images" class="hash-link" aria-label="Direct link to CLI and node images" title="Direct link to CLI and node images" translate="no">​</a></h3>
<p>It all starts with the CLI executable. The CLI is signed by Edgeless Systems. To ensure non-repudiability for CLI releases, Edgeless Systems publishes corresponding signatures to the public ledger of the <a href="https://www.sigstore.dev/" target="_blank" rel="noopener noreferrer" class="">sigstore project</a>. There&#x27;s a <a class="" href="/constellation/2.23/workflows/verify-cli">step-by-step guide</a> on how to verify CLI signatures based on sigstore.</p>
<p>The CLI contains the latest runtime measurements of the Constellation node image for all supported cloud platforms. In case a different version of the node image is to be used, the corresponding runtime measurements can be fetched using the CLI&#x27;s <a class="" href="/constellation/2.23/reference/cli#constellation-config-fetch-measurements">fetch-measurements command</a>. This command downloads the runtime measurements and the corresponding signature from cdn.confidential.cloud. See for example the following files corresponding to node image v2.16.3:</p>
<ul>
<li class=""><a href="https://cdn.confidential.cloud/constellation/v2/ref/-/stream/stable/v2.16.3/image/measurements.json" target="_blank" rel="noopener noreferrer" class="">Measurements</a></li>
<li class=""><a href="https://cdn.confidential.cloud/constellation/v2/ref/-/stream/stable/v2.16.3/image/measurements.json.sig" target="_blank" rel="noopener noreferrer" class="">Signature</a></li>
</ul>
<p>The CLI contains the long-term public key of Edgeless Systems to verify the signature of downloaded runtime measurements.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cluster-creation">Cluster creation<a href="#cluster-creation" class="hash-link" aria-label="Direct link to Cluster creation" title="Direct link to Cluster creation" translate="no">​</a></h3>
<p>When a cluster is <a class="" href="/constellation/2.23/workflows/create">created</a>, the CLI automatically verifies the runtime measurements of the <em>first node</em> using remote attestation. Based on this, the CLI and the first node set up a temporary TLS connection. This <a href="#attested-tls-atls" class="">aTLS</a> connection is used for two things:</p>
<ol>
<li class="">The CLI sends the <a class="" href="/constellation/2.23/architecture/keys#master-secret">master secret</a> of the to-be-created cluster to the CLI. The master secret is generated by the first node.</li>
<li class="">The first node sends a <a href="https://www.redhat.com/sysadmin/kubeconfig" target="_blank" rel="noopener noreferrer" class="">kubeconfig file</a> with Kubernetes credentials to the CLI.</li>
</ol>
<p>After this, the aTLS connection is closed and the first node bootstraps the Kubernetes cluster. All subsequent interactions between the CLI and the cluster go via the <a href="https://kubernetes.io/docs/concepts/overview/kubernetes-api/" target="_blank" rel="noopener noreferrer" class="">Kubernetes API</a> server running inside the cluster. The CLI (and other tools like kubectl) use the credentials referenced by the kubeconfig file to authenticate themselves towards the Kubernetes API server and to establish a mTLS connection.</p>
<p>The CLI connects to the Kubernetes API to write the runtime measurements for the applicable node image to etcd. The JoinService uses these runtime measurements to verify all nodes that join the cluster subsequently.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="chain-of-trust">Chain of trust<a href="#chain-of-trust" class="hash-link" aria-label="Direct link to Chain of trust" title="Direct link to Chain of trust" translate="no">​</a></h3>
<p>In summary, there&#x27;s a chain of trust based on cryptographic signatures that goes from the user to the cluster via the CLI. This is illustrated in the following diagram.</p>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="upgrades">Upgrades<a href="#upgrades" class="hash-link" aria-label="Direct link to Upgrades" title="Direct link to Upgrades" translate="no">​</a></h3>
<p>Whenever a cluster is <a class="" href="/constellation/2.23/workflows/upgrade">upgraded</a> to a new version of the node image, the CLI sends the corresponding runtime measurements via the Kubernetes API server. The new runtime measurements are stored in etcd within the cluster and replace any previous runtime measurements. The new runtime measurements are then used automatically by the JoinService for the verification of new nodes.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorTargetStickyNavbar_Vzrq sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes" translate="no">​</a></h2>
<ol>
<li class="anchorTargetStickyNavbar_Vzrq" id="user-content-fn-1">
<p>Linux IMA produces runtime measurements of user-space binaries.
However, these measurements aren&#x27;t deterministic and thus, PCR[10] can&#x27;t be compared to a constant value.
Instead, a policy engine must be used to verify the TPM event log against a policy. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a> <a href="#user-content-fnref-1-2" data-footnote-backref="" aria-label="Back to reference 1-2" class="data-footnote-backref">↩<sup>2</sup></a> <a href="#user-content-fnref-1-3" data-footnote-backref="" aria-label="Back to reference 1-3" class="data-footnote-backref">↩<sup>3</sup></a> <a href="#user-content-fnref-1-4" data-footnote-backref="" aria-label="Back to reference 1-4" class="data-footnote-backref">↩<sup>4</sup></a></p>
</li>
</ol>
</section></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.23/architecture/attestation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/constellation/2.23/architecture/microservices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Microservices</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/constellation/2.23/architecture/images"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Images</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terms" class="table-of-contents__link toc-highlight">Terms</a><ul><li><a href="#trusted-platform-module-tpm" class="table-of-contents__link toc-highlight">Trusted Platform Module (TPM)</a></li><li><a href="#runtime-measurement" class="table-of-contents__link toc-highlight">Runtime measurement</a></li><li><a href="#platform-configuration-register-pcr" class="table-of-contents__link toc-highlight">Platform Configuration Register (PCR)</a></li><li><a href="#measured-boot" class="table-of-contents__link toc-highlight">Measured boot</a></li><li><a href="#remote-attestation-ra" class="table-of-contents__link toc-highlight">Remote attestation (RA)</a></li><li><a href="#confidential-virtual-machine-cvm" class="table-of-contents__link toc-highlight">Confidential virtual machine (CVM)</a></li><li><a href="#attested-tls-atls" class="table-of-contents__link toc-highlight">Attested TLS (aTLS)</a></li></ul></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#node-attestation" class="table-of-contents__link toc-highlight">Node attestation</a><ul><li><a href="#runtime-measurements" class="table-of-contents__link toc-highlight">Runtime measurements</a></li><li><a href="#cvm-verification" class="table-of-contents__link toc-highlight">CVM verification</a></li></ul></li><li><a href="#cluster-attestation" class="table-of-contents__link toc-highlight">Cluster attestation</a><ul><li><a href="#cluster-facing-attestation" class="table-of-contents__link toc-highlight">Cluster-facing attestation</a></li><li><a href="#user-facing-attestation" class="table-of-contents__link toc-highlight">User-facing attestation</a></li></ul></li><li><a href="#putting-it-all-together" class="table-of-contents__link toc-highlight">Putting it all together</a><ul><li><a href="#cli-and-node-images" class="table-of-contents__link toc-highlight">CLI and node images</a></li><li><a href="#cluster-creation" class="table-of-contents__link toc-highlight">Cluster creation</a></li><li><a href="#chain-of-trust" class="table-of-contents__link toc-highlight">Chain of trust</a></li><li><a href="#upgrades" class="table-of-contents__link toc-highlight">Upgrades</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/constellation/overview/confidential-kubernetes">Confidential Kubernetes</a></li><li class="footer__item"><a class="footer__link-item" href="/constellation/getting-started/install">Install</a></li><li class="footer__item"><a class="footer__link-item" href="/constellation/getting-started/first-steps">First steps</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/edgelesssys/constellation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/#footer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Newsletter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/EdgelessSystems" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/edgeless-systems/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCOOInN0sCv6icUesisYIDeA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.edgeless.systems/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.edgeless.systems/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="javascript: Cookiebot.renew()" class="footer__link-item">Cookie Settings</a></li><li class="footer__item"><a href="https://www.edgeless.systems/contact-us/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Edgeless Systems</div></div></div></footer></div>
</body>
</html>