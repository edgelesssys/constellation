"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[656],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}},79402:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture/encrypted-storage","title":"Encrypted persistent storage","description":"Confidential VMs provide runtime memory encryption to protect data in use.","source":"@site/docs/architecture/encrypted-storage.md","sourceDirName":"architecture","slug":"/architecture/encrypted-storage","permalink":"/constellation/next/architecture/encrypted-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/docs/architecture/encrypted-storage.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Keys and cryptographic primitives","permalink":"/constellation/next/architecture/keys"},"next":{"title":"Networking","permalink":"/constellation/next/architecture/networking"}}');var i=n(74848),s=n(28453);const o={},a="Encrypted persistent storage",c={},d=[{value:"Cloud provider-managed encryption",id:"cloud-provider-managed-encryption",level:2},{value:"Constellation-managed encryption",id:"constellation-managed-encryption",level:2},{value:"Cryptographic algorithms",id:"cryptographic-algorithms",level:2},{value:"dm-crypt",id:"dm-crypt",level:3},{value:"dm-integrity",id:"dm-integrity",level:3},{value:"Encrypted S3 object storage",id:"encrypted-s3-object-storage",level:2}];function l(e){const t={a:"a",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"encrypted-persistent-storage",children:"Encrypted persistent storage"})}),"\n",(0,i.jsxs)(t.p,{children:["Confidential VMs provide runtime memory encryption to protect data in use.\nIn the context of Kubernetes, this is sufficient for the confidentiality and integrity of stateless services.\nConsider a front-end web server, for example, that keeps all connection information cached in main memory.\nNo sensitive data is ever written to an insecure medium.\nHowever, many real-world applications need some form of state or data-lake service that's connected to a persistent storage device and requires encryption at rest.\nAs described in ",(0,i.jsx)(t.a,{href:"/constellation/next/workflows/storage",children:"Use persistent storage"}),", cloud service providers (CSPs) use the container storage interface (CSI) to make their storage solutions available to Kubernetes workloads.\nThese CSI storage solutions often support some sort of encryption.\nFor example, Google Cloud ",(0,i.jsx)(t.a,{href:"https://cloud.google.com/security/encryption/default-encryption",children:"encrypts data at rest by default"}),", without any action required by the customer."]}),"\n",(0,i.jsx)(t.h2,{id:"cloud-provider-managed-encryption",children:"Cloud provider-managed encryption"}),"\n",(0,i.jsx)(t.p,{children:"CSP-managed storage solutions encrypt the data in the cloud backend before writing it physically to disk.\nIn the context of confidential computing and Constellation, the CSP and its managed services aren't trusted.\nHence, cloud provider-managed encryption protects your data from offline hardware access to physical storage devices.\nIt doesn't protect it from anyone with infrastructure-level access to the storage backend or a malicious insider in the cloud platform.\nEven with \"bring your own key\" or similar concepts, the CSP performs the encryption process with access to the keys and plaintext data."}),"\n",(0,i.jsx)(t.p,{children:"In the security model of Constellation, securing persistent storage and thereby data at rest requires that all cryptographic operations are performed inside a trusted execution environment.\nConsequently, using CSP-managed encryption of persistent storage usually isn't an option."}),"\n",(0,i.jsx)(t.h2,{id:"constellation-managed-encryption",children:"Constellation-managed encryption"}),"\n",(0,i.jsxs)(t.p,{children:["Constellation provides CSI drivers for storage solutions in all major clouds with built-in encryption support.\nBlock storage provisioned by the CSP is ",(0,i.jsx)(t.a,{href:"https://guix.gnu.org/manual/en/html_node/Mapped-Devices.html",children:"mapped"})," using the ",(0,i.jsx)(t.a,{href:"https://www.kernel.org/doc/html/latest/admin-guide/device-mapper/dm-crypt.html",children:"dm-crypt"}),", and optionally the ",(0,i.jsx)(t.a,{href:"https://www.kernel.org/doc/html/latest/admin-guide/device-mapper/dm-integrity.html",children:"dm-integrity"}),", kernel modules, before it's formatted and accessed by the Kubernetes workloads.\nAll cryptographic operations happen inside the trusted environment of the confidential Constellation node."]}),"\n",(0,i.jsxs)(t.p,{children:["Note that for integrity-protected disks, ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/blog/2018/07/12/resizing-persistent-volumes-using-kubernetes/",children:"volume expansion"})," isn't supported."]}),"\n",(0,i.jsxs)(t.p,{children:["By default the driver uses data encryption keys (DEKs) issued by the Constellation ",(0,i.jsx)(t.a,{href:"/constellation/next/architecture/microservices#keyservice",children:(0,i.jsx)(t.em,{children:"KeyService"})}),".\nThe DEKs are in turn derived from the Constellation's key encryption key (KEK), which is directly derived from the ",(0,i.jsx)(t.a,{href:"/constellation/next/architecture/keys#master-secret",children:"master secret"}),".\nThis is the recommended mode of operation, and also requires the least amount of setup by the cluster administrator."]}),"\n",(0,i.jsx)(t.p,{children:"Alternatively, the driver can be configured to use a key management system to store and access KEKs and DEKs."}),"\n",(0,i.jsxs)(t.p,{children:["Refer to ",(0,i.jsx)(t.a,{href:"/constellation/next/architecture/keys",children:"keys and cryptography"})," for more details on key management in Constellation."]}),"\n",(0,i.jsx)(t.p,{children:"Once deployed and configured, the CSI driver ensures transparent encryption and integrity of all persistent volumes provisioned via its storage class.\nData at rest is secured without any additional actions required by the developer."}),"\n",(0,i.jsx)(t.h2,{id:"cryptographic-algorithms",children:"Cryptographic algorithms"}),"\n",(0,i.jsx)(t.p,{children:"This section gives an overview of the libraries, cryptographic algorithms, and their configurations, used in Constellation's CSI drivers."}),"\n",(0,i.jsx)(t.h3,{id:"dm-crypt",children:"dm-crypt"}),"\n",(0,i.jsxs)(t.p,{children:["To interact with the dm-crypt kernel module, Constellation uses ",(0,i.jsx)(t.a,{href:"https://gitlab.com/cryptsetup/cryptsetup/",children:"libcryptsetup"}),".\nNew devices are formatted as ",(0,i.jsx)(t.a,{href:"https://gitlab.com/cryptsetup/LUKS2-docs/-/tree/master",children:"LUKS2"})," partitions with a sector size of 4096 bytes.\nThe used key derivation function is ",(0,i.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc9106",children:"Argon2id"})," with the ",(0,i.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc9106#section-7.4",children:"recommended parameters for memory-constrained environments"})," of 3 iterations and 64 MiB of memory, utilizing 4 parallel threads.\nFor encryption Constellation uses AES in XTS-Plain64. The key size is 512 bit."]}),"\n",(0,i.jsx)(t.h3,{id:"dm-integrity",children:"dm-integrity"}),"\n",(0,i.jsxs)(t.p,{children:["To interact with the dm-integrity kernel module, Constellation uses ",(0,i.jsx)(t.a,{href:"https://gitlab.com/cryptsetup/cryptsetup/",children:"libcryptsetup"}),".\nWhen enabled, the used data integrity algorithm is ",(0,i.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc2104",children:"HMAC"})," with SHA256 as the hash function.\nThe tag size is 32 Bytes."]}),"\n",(0,i.jsx)(t.h2,{id:"encrypted-s3-object-storage",children:"Encrypted S3 object storage"}),"\n",(0,i.jsxs)(t.p,{children:["Constellation comes with a service that you can use to transparently retrofit client-side encryption to existing applications that use S3 (AWS or compatible) for storage.\nTo learn more, check out the ",(0,i.jsx)(t.a,{href:"/constellation/next/workflows/s3proxy",children:"s3proxy documentation"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);