"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[4263],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(96540);const o={},i=t.createContext(o);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},45577:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"workflows/trusted-launch","title":"Use Azure trusted launch VMs","description":"Constellation also supports trusted launch VMs on Microsoft Azure. Trusted launch VMs don\'t offer the same level of security as Confidential VMs, but are available in more regions and in larger quantities. The main difference between trusted launch VMs and normal VMs is that the former offer vTPM-based remote attestation. When used with trusted launch VMs, Constellation relies on vTPM-based remote attestation to verify nodes.","source":"@site/versioned_docs/version-2.22/workflows/trusted-launch.md","sourceDirName":"workflows","slug":"/workflows/trusted-launch","permalink":"/constellation/2.22/workflows/trusted-launch","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.22/workflows/trusted-launch.md","tags":[],"version":"2.22","frontMatter":{}}');var o=s(74848),i=s(28453);const r={},a="Use Azure trusted launch VMs",l={},c=[{value:"VM images",id:"vm-images",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"use-azure-trusted-launch-vms",children:"Use Azure trusted launch VMs"})}),"\n",(0,o.jsxs)(n.p,{children:["Constellation also supports ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch",children:"trusted launch VMs"})," on Microsoft Azure. Trusted launch VMs don't offer the same level of security as Confidential VMs, but are available in more regions and in larger quantities. The main difference between trusted launch VMs and normal VMs is that the former offer vTPM-based remote attestation. When used with trusted launch VMs, Constellation relies on vTPM-based remote attestation to verify nodes."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"Trusted launch VMs don't provide runtime encryption and don't keep the cloud service provider (CSP) out of your trusted computing base."})}),"\n",(0,o.jsxs)(n.p,{children:["Constellation supports trusted launch VMs with instance types ",(0,o.jsx)(n.code,{children:"Standard_D*_v4"})," and ",(0,o.jsx)(n.code,{children:"Standard_E*_v4"}),". Run ",(0,o.jsx)(n.code,{children:"constellation config instance-types"})," for a list of all supported instance types."]}),"\n",(0,o.jsx)(n.h2,{id:"vm-images",children:"VM images"}),"\n",(0,o.jsxs)(n.p,{children:["Azure currently doesn't support ",(0,o.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/virtual-machines/share-gallery-community",children:"community galleries for trusted launch VMs"}),". Thus, you need to manually import the Constellation node image into your cloud subscription."]}),"\n",(0,o.jsxs)(n.p,{children:["The latest image is available at ",(0,o.jsx)(n.code,{children:"https://cdn.confidential.cloud/constellation/images/azure/trusted-launch/v2.2.0/constellation.img"}),". Simply adjust the version number to download a newer version."]}),"\n",(0,o.jsxs)(n.p,{children:["After you've downloaded the image, create a resource group ",(0,o.jsx)(n.code,{children:"constellation-images"})," in your Azure subscription and import the image.\nYou can use a script to do this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"wget https://raw.githubusercontent.com/edgelesssys/constellation/main/hack/importAzure.sh\nchmod +x importAzure.sh\nAZURE_IMAGE_VERSION=2.2.0 AZURE_RESOURCE_GROUP_NAME=constellation-images AZURE_IMAGE_FILE=./constellation.img ./importAzure.sh\n"})}),"\n",(0,o.jsx)(n.p,{children:"The script creates the following resources:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["A new image gallery with the default name ",(0,o.jsx)(n.code,{children:"constellation-import"})]}),"\n",(0,o.jsxs)(n.li,{children:["A new image definition with the default name ",(0,o.jsx)(n.code,{children:"constellation"})]}),"\n",(0,o.jsxs)(n.li,{children:["The actual image with the provided version. In this case ",(0,o.jsx)(n.code,{children:"2.2.0"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Once the import is completed, use the ",(0,o.jsx)(n.code,{children:"ID"})," of the image version in your ",(0,o.jsx)(n.code,{children:"constellation-conf.yaml"})," for the ",(0,o.jsx)(n.code,{children:"image"})," field. Set ",(0,o.jsx)(n.code,{children:"confidentialVM"})," to ",(0,o.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Fetch the image measurements:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"IMAGE_VERSION=2.2.0\nURL=https://public-edgeless-constellation.s3.us-east-2.amazonaws.com//communitygalleries/constellationcvm-b3782fa0-0df7-4f2f-963e-fc7fc42663df/images/constellation/versions/$IMAGE_VERSION/measurements.yaml\nconstellation config fetch-measurements -u$URL -s$URL.sig\n"})}),"\n",(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"/constellation/2.22/workflows/create",children:(0,o.jsx)(n.code,{children:"constellation apply"})})," command will issue a warning because manually imported images aren't recognized as production grade images:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell-session",children:"Configured image doesn't look like a released production image. Double check image before deploying to production.\n"})}),(0,o.jsx)(n.p,{children:"Please ignore this warning."})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);