"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[5423],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(96540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}},86057:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"architecture/attestation","title":"Attestation","description":"This page explains Constellation\'s attestation process and highlights the cornerstones of its trust model.","source":"@site/versioned_docs/version-2.23/architecture/attestation.md","sourceDirName":"architecture","slug":"/architecture/attestation","permalink":"/constellation/2.23/architecture/attestation","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.23/architecture/attestation.md","tags":[],"version":"2.23","frontMatter":{},"sidebar":"docs","previous":{"title":"Microservices","permalink":"/constellation/2.23/architecture/microservices"},"next":{"title":"Images","permalink":"/constellation/2.23/architecture/images"}}');var i=n(74848),r=n(28453);const o={},a="Attestation",d={},l=[{value:"Terms",id:"terms",level:2},{value:"Trusted Platform Module (TPM)",id:"trusted-platform-module-tpm",level:3},{value:"Runtime measurement",id:"runtime-measurement",level:3},{value:"Platform Configuration Register (PCR)",id:"platform-configuration-register-pcr",level:3},{value:"Measured boot",id:"measured-boot",level:3},{value:"Remote attestation (RA)",id:"remote-attestation-ra",level:3},{value:"Confidential virtual machine (CVM)",id:"confidential-virtual-machine-cvm",level:3},{value:"Attested TLS (aTLS)",id:"attested-tls-atls",level:3},{value:"Overview",id:"overview",level:2},{value:"Node attestation",id:"node-attestation",level:2},{value:"Runtime measurements",id:"runtime-measurements",level:3},{value:"CVM verification",id:"cvm-verification",level:3},{value:"Cluster attestation",id:"cluster-attestation",level:2},{value:"Cluster-facing attestation",id:"cluster-facing-attestation",level:3},{value:"User-facing attestation",id:"user-facing-attestation",level:3},{value:"Putting it all together",id:"putting-it-all-together",level:2},{value:"CLI and node images",id:"cli-and-node-images",level:3},{value:"Cluster creation",id:"cluster-creation",level:3},{value:"Chain of trust",id:"chain-of-trust",level:3},{value:"Upgrades",id:"upgrades",level:3},{value:"References",id:"references",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{TabItem:n,Tabs:s}=t;return n||u("TabItem",!0),s||u("Tabs",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"attestation",children:"Attestation"})}),"\n",(0,i.jsx)(t.p,{children:"This page explains Constellation's attestation process and highlights the cornerstones of its trust model."}),"\n",(0,i.jsx)(t.h2,{id:"terms",children:"Terms"}),"\n",(0,i.jsx)(t.p,{children:"The following lists terms and concepts that help to understand the attestation concept of Constellation."}),"\n",(0,i.jsx)(t.h3,{id:"trusted-platform-module-tpm",children:"Trusted Platform Module (TPM)"}),"\n",(0,i.jsxs)(t.p,{children:["A TPM chip is a dedicated tamper-resistant crypto-processor.\nIt can securely store artifacts such as passwords, certificates, encryption keys, or ",(0,i.jsx)(t.em,{children:"runtime measurements"})," (more on this below).\nWhen a TPM is implemented in software, it's typically called a ",(0,i.jsx)(t.em,{children:"virtual"})," TPM (vTPM)."]}),"\n",(0,i.jsx)(t.h3,{id:"runtime-measurement",children:"Runtime measurement"}),"\n",(0,i.jsxs)(t.p,{children:["A runtime measurement is a cryptographic hash of the memory pages of a so called ",(0,i.jsx)(t.em,{children:"runtime component"}),". Runtime components of interest typically include a system's bootloader or OS kernel."]}),"\n",(0,i.jsx)(t.h3,{id:"platform-configuration-register-pcr",children:"Platform Configuration Register (PCR)"}),"\n",(0,i.jsx)(t.p,{children:"A Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties.\nTo store a new value in a PCR, the existing value is extended with a new value as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"PCR[N] = HASHalg( PCR[N] || ArgumentOfExtend )\n"})}),"\n",(0,i.jsx)(t.p,{children:"The PCRs are typically used to store runtime measurements.\nThe new value of a PCR is always an extension of the existing value.\nThus, storing the measurements of multiple components into the same PCR irreversibly links them together."}),"\n",(0,i.jsx)(t.h3,{id:"measured-boot",children:"Measured boot"}),"\n",(0,i.jsx)(t.p,{children:"Measured boot builds on the concept of chained runtime measurements.\nEach component in the boot chain loads and measures the next component into the PCR before executing it.\nBy comparing the resulting PCR values against trusted reference values, the integrity of the entire boot chain and thereby the running system can be ensured."}),"\n",(0,i.jsx)(t.h3,{id:"remote-attestation-ra",children:"Remote attestation (RA)"}),"\n",(0,i.jsx)(t.p,{children:"Remote attestation is the process of verifying certain properties of an application or platform, such as integrity and confidentiality, from a remote location.\nIn the case of a measured boot, the goal is to obtain a signed attestation statement on the PCR values of the boot measurements.\nThe statement can then be verified and compared to a set of trusted reference values.\nThis way, the integrity of the platform can be ensured before sharing secrets with it."}),"\n",(0,i.jsx)(t.h3,{id:"confidential-virtual-machine-cvm",children:"Confidential virtual machine (CVM)"}),"\n",(0,i.jsx)(t.p,{children:"Confidential computing (CC) is the protection of data in-use with hardware-based trusted execution environments (TEEs).\nWith CVMs, TEEs encapsulate entire virtual machines and isolate them against the hypervisor, other VMs, and direct memory access.\nAfter loading the initial VM image into encrypted memory, the hypervisor calls for a secure processor to measure these initial memory pages.\nThe secure processor locks these pages and generates an attestation report on the initial page measurements.\nCVM memory pages are encrypted with a key that resides inside the secure processor, which makes sure only the guest VM can access them.\nThe attestation report is signed by the secure processor and can be verified using remote attestation via the certificate authority of the hardware vendor.\nSuch an attestation statement guarantees the confidentiality and integrity of a CVM."}),"\n",(0,i.jsx)(t.h3,{id:"attested-tls-atls",children:"Attested TLS (aTLS)"}),"\n",(0,i.jsx)(t.p,{children:"In a CC environment, attested TLS (aTLS) can be used to establish secure connections between two parties using the remote attestation features of the CC components."}),"\n",(0,i.jsx)(t.p,{children:"aTLS modifies the TLS handshake by embedding an attestation statement into the TLS certificate.\nInstead of relying on a certificate authority, aTLS uses this attestation statement to establish trust in the certificate."}),"\n",(0,i.jsx)(t.p,{children:"The protocol can be used by clients to verify a server certificate, by a server to verify a client certificate, or for mutual verification (mutual aTLS)."}),"\n",(0,i.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(t.p,{children:"The challenge for Constellation is to lift a CVM's attestation statement to the Kubernetes software layer and make it end-to-end verifiable.\nFrom there, Constellation needs to expand the attestation from a single CVM to the entire cluster."}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#joinservice",children:(0,i.jsx)(t.em,{children:"JoinService"})})," and ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#verificationservice",children:(0,i.jsx)(t.em,{children:"VerificationService"})})," are where all runs together.\nInternally, the ",(0,i.jsx)(t.em,{children:"JoinService"})," uses remote attestation to securely join CVM nodes to the cluster.\nExternally, the ",(0,i.jsx)(t.em,{children:"VerificationService"})," provides an attestation statement for the cluster's CVMs and configuration."]}),"\n",(0,i.jsx)(t.p,{children:"The following explains the details of both steps."}),"\n",(0,i.jsx)(t.h2,{id:"node-attestation",children:"Node attestation"}),"\n",(0,i.jsx)(t.p,{children:"The idea is that Constellation nodes should have verifiable integrity from the CVM hardware measurement up to the Kubernetes software layer.\nThe solution is a verifiable boot chain and an integrity-protected runtime environment."}),"\n",(0,i.jsxs)(t.p,{children:["Constellation uses measured boot within CVMs, measuring each component in the boot process before executing it.\nOutside of CC, this is usually implemented via TPMs.\nCVM technologies differ in how they implement runtime measurements, but the general concepts are similar to those of a TPM.\nFor simplicity, TPM terminology like ",(0,i.jsx)(t.em,{children:"PCR"})," is used in the following."]}),"\n",(0,i.jsxs)(t.p,{children:["When a Constellation node image boots inside a CVM, measured boot is used for all stages and components of the boot chain.\nThis process goes up to the root filesystem.\nThe root filesystem is mounted read-only with integrity protection.\nFor the details on the image and boot stages see the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/images",children:"image architecture"})," documentation.\nAny changes to the image will inevitably also change the corresponding PCR values.\nTo create a node attestation statement, the Constellation image obtains a CVM attestation statement from the hardware.\nThis includes the runtime measurements and thereby binds the measured boot results to the CVM hardware measurement."]}),"\n",(0,i.jsxs)(t.p,{children:["In addition to the image measurements, Constellation extends a PCR during the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/workflows/create",children:"initialization phase"})," that irrevocably marks the node as initialized.\nThe measurement is created using the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/keys#cluster-identity",children:(0,i.jsx)(t.em,{children:"clusterID"})}),", tying all future attestation statements to this ID.\nThereby, an attestation statement is unique for every cluster and a node can be identified unambiguously as being initialized."]}),"\n",(0,i.jsxs)(t.p,{children:["To verify an attestation, the hardware's signature and a statement are verified first to establish trust in the contained runtime measurements.\nIf successful, the measurements are verified against the trusted values of the particular Constellation release version.\nFinally, the measurement of the ",(0,i.jsx)(t.em,{children:"clusterID"})," can be compared by calculating it with the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/keys#master-secret",children:"master secret"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"runtime-measurements",children:"Runtime measurements"}),"\n",(0,i.jsx)(t.p,{children:"Constellation uses runtime measurements to implement the measured boot approach.\nAs stated above, the underlying hardware technology and guest firmware differ in their implementations of runtime measurements.\nThe following gives a detailed description of the available measurements in the different cloud environments."}),"\n",(0,i.jsx)(t.p,{children:"The runtime measurements consist of two types of values:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Measurements produced by the cloud infrastructure and firmware of the CVM"}),":\nThese are measurements of closed-source firmware and other values controlled by the cloud provider.\nWhile not being reproducible for the user, some of them can be compared against previously observed values.\nOthers may change frequently and aren't suitable for verification.\nThe ",(0,i.jsx)(t.a,{href:"#chain-of-trust",children:"signed image measurements"})," include measurements that are known, previously observed values."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Measurements produced by the Constellation bootloader and boot chain"}),":\nThe Constellation Bootloader takes over from the CVM firmware and ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/images",children:"measures the rest of the boot chain"}),".\nThe Constellation ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#bootstrapper",children:"Bootstrapper"})," is the first user mode component that runs in a Constellation image.\nIt extends PCR registers with the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/keys#cluster-identity",children:"IDs"})," of the cluster marking a node as initialized."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Constellation allows to specify in the config which measurements should be enforced during the attestation process.\nEnforcing non-reproducible measurements controlled by the cloud provider means that changes in these values require manual updates to the cluster's config.\nBy default, Constellation only enforces measurements that are stable values produced by the infrastructure or by Constellation directly."}),"\n",(0,i.jsxs)(s,{groupId:"csp",children:[(0,i.jsxs)(n,{value:"aws",label:"AWS",children:[(0,i.jsxs)(t.p,{children:["Constellation uses the ",(0,i.jsx)(t.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nitrotpm.html",children:"vTPM"})," (NitroTPM) feature of the ",(0,i.jsx)(t.a,{href:"http://aws.amazon.com/ec2/nitro/",children:"AWS Nitro System"})," on AWS for runtime measurements."]}),(0,i.jsxs)(t.p,{children:["The vTPM adheres to the ",(0,i.jsx)(t.a,{href:"https://trustedcomputinggroup.org/resource/tpm-library-specification/",children:"TPM 2.0"})," specification.\nThe VMs are attested by obtaining signed PCR values over the VM's boot configuration from the TPM and comparing them to a known, good state (measured boot)."]}),(0,i.jsx)(t.p,{children:"The following table lists all PCR values of the vTPM and the measured components.\nIt also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.\nThe latter means that the value can be generated offline and compared to the one in the vTPM."}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"PCR"}),(0,i.jsx)(t.th,{children:"Components"}),(0,i.jsx)(t.th,{children:"Measured by"}),(0,i.jsx)(t.th,{children:"Reproducible and verifiable"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader, Kernel, initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"AWS, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"6"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"AWS"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"7"}),(0,i.jsx)(t.td,{children:"Secure Boot Policy"}),(0,i.jsx)(t.td,{children:"AWS, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"8"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"9"}),(0,i.jsx)(t.td,{children:"initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"Linux Kernel"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"User space"}),(0,i.jsx)(t.td,{children:"Linux IMA"}),(0,i.jsxs)(t.td,{children:["No",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"11"}),(0,i.jsx)(t.td,{children:"Unified Kernel Image components"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"12"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(User space, Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"13"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"14"}),(0,i.jsx)(t.td,{children:"Secure Boot State"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"ClusterID"}),(0,i.jsx)(t.td,{children:"Constellation Bootstrapper"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"16\u201323"}),(0,i.jsx)(t.td,{children:"Unused"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]})]})]})]}),(0,i.jsxs)(n,{value:"azure",label:"Azure",children:[(0,i.jsxs)(t.p,{children:["Constellation uses the ",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch#vtpm",children:"vTPM"})," feature of Azure CVMs for runtime measurements.\nThis vTPM adheres to the ",(0,i.jsx)(t.a,{href:"https://trustedcomputinggroup.org/resource/tpm-library-specification/",children:"TPM 2.0"})," specification.\nIt provides a ",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/security/fundamentals/measured-boot-host-attestation#measured-boot",children:"measured boot"})," verification that's based on the trusted launch feature of ",(0,i.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch",children:"Trusted Launch VMs"}),"."]}),(0,i.jsx)(t.p,{children:"The following table lists all PCR values of the vTPM and the measured components.\nIt also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.\nThe latter means that the value can be generated offline and compared to the one in the vTPM."}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"PCR"}),(0,i.jsx)(t.th,{children:"Components"}),(0,i.jsx)(t.th,{children:"Measured by"}),(0,i.jsx)(t.th,{children:"Reproducible and verifiable"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader, Kernel, initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"Azure, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"6"}),(0,i.jsx)(t.td,{children:"VM Unique ID"}),(0,i.jsx)(t.td,{children:"Azure"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"7"}),(0,i.jsx)(t.td,{children:"Secure Boot State"}),(0,i.jsx)(t.td,{children:"Azure, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"8"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"9"}),(0,i.jsx)(t.td,{children:"initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"Linux Kernel"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"User space"}),(0,i.jsx)(t.td,{children:"Linux IMA"}),(0,i.jsxs)(t.td,{children:["No",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"11"}),(0,i.jsx)(t.td,{children:"Unified Kernel Image components"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"12"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(User space, Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"13"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"14"}),(0,i.jsx)(t.td,{children:"Secure Boot State"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"ClusterID"}),(0,i.jsx)(t.td,{children:"Constellation Bootstrapper"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"16\u201323"}),(0,i.jsx)(t.td,{children:"Unused"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]})]})]})]}),(0,i.jsxs)(n,{value:"gcp",label:"GCP",children:[(0,i.jsxs)(t.p,{children:["Constellation uses the ",(0,i.jsx)(t.a,{href:"https://cloud.google.com/compute/confidential-vm/docs/about-cvm",children:"vTPM"})," feature of CVMs on GCP for runtime measurements.\nNote that this vTPM doesn't run inside the hardware-protected CVM context, but is emulated by the hypervisor."]}),(0,i.jsxs)(t.p,{children:["The vTPM adheres to the ",(0,i.jsx)(t.a,{href:"https://trustedcomputinggroup.org/resource/tpm-library-specification/",children:"TPM 2.0"})," specification.\nIt provides a ",(0,i.jsx)(t.a,{href:"https://cloud.google.com/compute/confidential-vm/docs/monitoring#about_launch_attestation_report_events",children:"launch attestation report"})," that's based on the measured boot feature of ",(0,i.jsx)(t.a,{href:"https://cloud.google.com/compute/shielded-vm/docs/shielded-vm#measured-boot",children:"Shielded VMs"}),"."]}),(0,i.jsx)(t.p,{children:"The following table lists all PCR values of the vTPM and the measured components.\nIt also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.\nThe latter means that the value can be generated offline and compared to the one in the vTPM."}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"PCR"}),(0,i.jsx)(t.th,{children:"Components"}),(0,i.jsx)(t.th,{children:"Measured by"}),(0,i.jsx)(t.th,{children:"Reproducible and verifiable"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"CVM version and technology"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader, Kernel, initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"GCP, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Disk GUID partition table"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"6"}),(0,i.jsx)(t.td,{children:"Disk GUID partition table"}),(0,i.jsx)(t.td,{children:"GCP"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"7"}),(0,i.jsx)(t.td,{children:"GCP Secure Boot Policy"}),(0,i.jsx)(t.td,{children:"GCP, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"8"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"9"}),(0,i.jsx)(t.td,{children:"initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"Linux Kernel"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"User space"}),(0,i.jsx)(t.td,{children:"Linux IMA"}),(0,i.jsxs)(t.td,{children:["No",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"11"}),(0,i.jsx)(t.td,{children:"Unified Kernel Image components"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"12"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(User space, Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"13"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"14"}),(0,i.jsx)(t.td,{children:"Secure Boot State"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"ClusterID"}),(0,i.jsx)(t.td,{children:"Constellation Bootstrapper"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"16\u201323"}),(0,i.jsx)(t.td,{children:"Unused"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]})]})]})]}),(0,i.jsxs)(n,{value:"stackit",label:"STACKIT",children:[(0,i.jsx)(t.p,{children:"Constellation uses a hypervisor-based vTPM for runtime measurements."}),(0,i.jsxs)(t.p,{children:["The vTPM adheres to the ",(0,i.jsx)(t.a,{href:"https://trustedcomputinggroup.org/resource/tpm-library-specification/",children:"TPM 2.0"})," specification.\nThe VMs are attested by obtaining signed PCR values over the VM's boot configuration from the TPM and comparing them to a known, good state (measured boot)."]}),(0,i.jsx)(t.p,{children:"The following table lists all PCR values of the vTPM and the measured components.\nIt also lists what components of the boot chain did the measurements and if the value is reproducible and verifiable.\nThe latter means that the value can be generated offline and compared to the one in the vTPM."}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"PCR"}),(0,i.jsx)(t.th,{children:"Components"}),(0,i.jsx)(t.th,{children:"Measured by"}),(0,i.jsx)(t.th,{children:"Reproducible and verifiable"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader, Kernel, initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"STACKIT, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"6"}),(0,i.jsx)(t.td,{children:"Firmware"}),(0,i.jsx)(t.td,{children:"STACKIT"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"7"}),(0,i.jsx)(t.td,{children:"Secure Boot Policy"}),(0,i.jsx)(t.td,{children:"STACKIT, Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"8"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"9"}),(0,i.jsx)(t.td,{children:"initramfs, Kernel command line"}),(0,i.jsx)(t.td,{children:"Linux Kernel"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"10"}),(0,i.jsx)(t.td,{children:"User space"}),(0,i.jsx)(t.td,{children:"Linux IMA"}),(0,i.jsxs)(t.td,{children:["No",(0,i.jsx)(t.sup,{children:(0,i.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"11"}),(0,i.jsx)(t.td,{children:"Unified Kernel Image components"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"12"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(User space, Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"13"}),(0,i.jsx)(t.td,{children:"Reserved"}),(0,i.jsx)(t.td,{children:"(Constellation Bootloader)"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"14"}),(0,i.jsx)(t.td,{children:"Secure Boot State"}),(0,i.jsx)(t.td,{children:"Constellation Bootloader"}),(0,i.jsx)(t.td,{children:"No"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"15"}),(0,i.jsx)(t.td,{children:"ClusterID"}),(0,i.jsx)(t.td,{children:"Constellation Bootstrapper"}),(0,i.jsx)(t.td,{children:"Yes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"16\u201323"}),(0,i.jsx)(t.td,{children:"Unused"}),(0,i.jsx)(t.td,{children:"-"}),(0,i.jsx)(t.td,{children:"-"})]})]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"cvm-verification",children:"CVM verification"}),"\n",(0,i.jsx)(t.p,{children:"To verify the integrity of the received attestation statement, a chain of trust from the CVM technology to the interface providing the statement has to be established.\nFor verification of the CVM technology, Constellation may expose additional options in its config file."}),"\n",(0,i.jsxs)(s,{groupId:"csp",children:[(0,i.jsxs)(n,{value:"aws",label:"AWS",children:[(0,i.jsx)(t.p,{children:"On AWS, AMD SEV-SNP is used to provide runtime encryption to the VMs.\nAn SEV-SNP attestation report is used to establish trust in the VM.\nYou may customize certain parameters for verification of the attestation statement using the Constellation config file."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"TCB versions"}),"\n",(0,i.jsx)(t.p,{children:"You can set the minimum version numbers of components in the SEV-SNP TCB.\nUse the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.\nAlternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"AMD Root Key Certificate"}),"\n",(0,i.jsx)(t.p,{children:"This certificate is the root of trust for verifying the SEV-SNP certificate chain."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"AMD Signing Key Certificate"}),"\n",(0,i.jsx)(t.p,{children:"This is the intermediate certificate for verifying the SEV-SNP report's signature.\nIf it's not specified, the CLI fetches it from the AMD key distribution server."}),"\n"]}),"\n"]})]}),(0,i.jsxs)(n,{value:"azure",label:"Azure SEV-SNP",children:[(0,i.jsx)(t.p,{children:"On Azure, AMD SEV-SNP is used to provide runtime encryption to the VMs.\nAn SEV-SNP attestation report is used to establish trust in the vTPM running inside the VM.\nYou may customize certain parameters for verification of the attestation statement using the Constellation config file."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"TCB versions"}),"\n",(0,i.jsx)(t.p,{children:"You can set the minimum version numbers of components in the SEV-SNP TCB.\nUse the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.\nAlternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"AMD Root Key Certificate"}),"\n",(0,i.jsx)(t.p,{children:"This certificate is the root of trust for verifying the SEV-SNP certificate chain."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Firmware Signer"}),"\n",(0,i.jsxs)(t.p,{children:["This config option allows you to specify how the firmware signer should be verified.\nMore explicitly, it controls the verification of the ",(0,i.jsx)(t.code,{children:"IDKeyDigest"})," value in the SEV-SNP attestation report.\nYou can provide a list of accepted key digests and specify a policy on how this list is compared against the reported ",(0,i.jsx)(t.code,{children:"IDKeyDigest"}),"."]}),"\n"]}),"\n"]})]}),(0,i.jsxs)(n,{value:"gcp",label:"GCP",children:[(0,i.jsx)(t.p,{children:"On GCP, AMD SEV-SNP is used to provide runtime encryption to the VMs.\nAn SEV-SNP attestation report is used to establish trust in the VM.\nYou may customize certain parameters for verification of the attestation statement using the Constellation config file."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"TCB versions"}),"\n",(0,i.jsx)(t.p,{children:"You can set the minimum version numbers of components in the SEV-SNP TCB.\nUse the latest versions to enforce that only machines with the most recent firmware updates are allowed to join the cluster.\nAlternatively, you can set a lower minimum version to allow slightly out-of-date machines to still be able to join the cluster."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"AMD Root Key Certificate"}),"\n",(0,i.jsx)(t.p,{children:"This certificate is the root of trust for verifying the SEV-SNP certificate chain."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"AMD Signing Key Certificate"}),"\n",(0,i.jsx)(t.p,{children:"This is the intermediate certificate for verifying the SEV-SNP report's signature.\nIf it's not specified, the CLI fetches it from the AMD key distribution server."}),"\n"]}),"\n"]})]}),(0,i.jsx)(n,{value:"stackit",label:"STACKIT",children:(0,i.jsxs)(t.p,{children:["On STACKIT, AMD SEV-ES is used to provide runtime encryption to the VMs.\nThe hypervisor-based vTPM is used to establish trust in the VM via ",(0,i.jsx)(t.a,{href:"#runtime-measurements",children:"runtime measurements"}),".\nThere is no additional configuration available for STACKIT."]})})]}),"\n",(0,i.jsx)(t.h2,{id:"cluster-attestation",children:"Cluster attestation"}),"\n",(0,i.jsxs)(t.p,{children:["Cluster-facing, Constellation's ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#joinservice",children:(0,i.jsx)(t.em,{children:"JoinService"})})," verifies each node joining the cluster given the configured ground truth runtime measurements.\nUser-facing, the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#verificationservice",children:(0,i.jsx)(t.em,{children:"VerificationService"})})," provides an interface to verify a node using remote attestation.\nBy verifying the first node during the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#bootstrapper",children:"initialization"})," and configuring the ground truth measurements that are subsequently enforced by the ",(0,i.jsx)(t.em,{children:"JoinService"}),", the whole cluster is verified in a transitive way."]}),"\n",(0,i.jsx)(t.h3,{id:"cluster-facing-attestation",children:"Cluster-facing attestation"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.em,{children:"JoinService"})," is provided with the runtime measurements of the whitelisted Constellation image version as the ground truth.\nDuring the initialization and the cluster bootstrapping, each node connects to the ",(0,i.jsx)(t.em,{children:"JoinService"})," using ",(0,i.jsx)(t.a,{href:"#attested-tls-atls",children:"aTLS"}),".\nDuring the handshake, the node transmits an attestation statement including its runtime measurements.\nThe ",(0,i.jsx)(t.em,{children:"JoinService"})," verifies that statement and compares the measurements against the ground truth.\nFor details of the initialization process check the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices",children:"microservice descriptions"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["After the initialization, every node updates its runtime measurements with the ",(0,i.jsx)(t.em,{children:"clusterID"})," value, marking it irreversibly as initialized.\nWhen an initialized node tries to join another cluster, its measurements inevitably mismatch the measurements of an uninitialized node and it will be declined."]}),"\n",(0,i.jsx)(t.h3,{id:"user-facing-attestation",children:"User-facing attestation"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#verificationservice",children:(0,i.jsx)(t.em,{children:"VerificationService"})})," provides an endpoint for obtaining its hardware-based remote attestation statement, which includes the runtime measurements.\nA user can ",(0,i.jsx)(t.a,{href:"/constellation/2.23/workflows/verify-cluster",children:"verify"})," this statement and compare the measurements against the configured ground truth and, thus, verify the identity and integrity of all Constellation components and the cluster configuration. Subsequently, the user knows that the entire cluster is in the expected state and is trustworthy."]}),"\n",(0,i.jsx)(t.h2,{id:"putting-it-all-together",children:"Putting it all together"}),"\n",(0,i.jsx)(t.p,{children:"This section puts the aforementioned concepts together and illustrate how trust into a Constellation cluster is established and maintained."}),"\n",(0,i.jsx)(t.h3,{id:"cli-and-node-images",children:"CLI and node images"}),"\n",(0,i.jsxs)(t.p,{children:["It all starts with the CLI executable. The CLI is signed by Edgeless Systems. To ensure non-repudiability for CLI releases, Edgeless Systems publishes corresponding signatures to the public ledger of the ",(0,i.jsx)(t.a,{href:"https://www.sigstore.dev/",children:"sigstore project"}),". There's a ",(0,i.jsx)(t.a,{href:"/constellation/2.23/workflows/verify-cli",children:"step-by-step guide"})," on how to verify CLI signatures based on sigstore."]}),"\n",(0,i.jsxs)(t.p,{children:["The CLI contains the latest runtime measurements of the Constellation node image for all supported cloud platforms. In case a different version of the node image is to be used, the corresponding runtime measurements can be fetched using the CLI's ",(0,i.jsx)(t.a,{href:"/constellation/2.23/reference/cli#constellation-config-fetch-measurements",children:"fetch-measurements command"}),". This command downloads the runtime measurements and the corresponding signature from cdn.confidential.cloud. See for example the following files corresponding to node image v2.16.3:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://cdn.confidential.cloud/constellation/v2/ref/-/stream/stable/v2.16.3/image/measurements.json",children:"Measurements"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://cdn.confidential.cloud/constellation/v2/ref/-/stream/stable/v2.16.3/image/measurements.json.sig",children:"Signature"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The CLI contains the long-term public key of Edgeless Systems to verify the signature of downloaded runtime measurements."}),"\n",(0,i.jsx)(t.h3,{id:"cluster-creation",children:"Cluster creation"}),"\n",(0,i.jsxs)(t.p,{children:["When a cluster is ",(0,i.jsx)(t.a,{href:"/constellation/2.23/workflows/create",children:"created"}),", the CLI automatically verifies the runtime measurements of the ",(0,i.jsx)(t.em,{children:"first node"})," using remote attestation. Based on this, the CLI and the first node set up a temporary TLS connection. This ",(0,i.jsx)(t.a,{href:"#attested-tls-atls",children:"aTLS"})," connection is used for two things:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["The CLI sends the ",(0,i.jsx)(t.a,{href:"/constellation/2.23/architecture/keys#master-secret",children:"master secret"})," of the to-be-created cluster to the CLI. The master secret is generated by the first node."]}),"\n",(0,i.jsxs)(t.li,{children:["The first node sends a ",(0,i.jsx)(t.a,{href:"https://www.redhat.com/sysadmin/kubeconfig",children:"kubeconfig file"})," with Kubernetes credentials to the CLI."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["After this, the aTLS connection is closed and the first node bootstraps the Kubernetes cluster. All subsequent interactions between the CLI and the cluster go via the ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/overview/kubernetes-api/",children:"Kubernetes API"})," server running inside the cluster. The CLI (and other tools like kubectl) use the credentials referenced by the kubeconfig file to authenticate themselves towards the Kubernetes API server and to establish a mTLS connection."]}),"\n",(0,i.jsx)(t.p,{children:"The CLI connects to the Kubernetes API to write the runtime measurements for the applicable node image to etcd. The JoinService uses these runtime measurements to verify all nodes that join the cluster subsequently."}),"\n",(0,i.jsx)(t.h3,{id:"chain-of-trust",children:"Chain of trust"}),"\n",(0,i.jsx)(t.p,{children:"In summary, there's a chain of trust based on cryptographic signatures that goes from the user to the cluster via the CLI. This is illustrated in the following diagram."}),"\n",(0,i.jsx)(t.mermaid,{value:'flowchart LR\n  A[User]-- "verifies" --\x3eB[CLI]\n  B[CLI]-- "verifies" --\x3eC([Runtime measurements])\n  D[Edgeless Systems]-- "signs" --\x3eB[CLI]\n  D[Edgeless Systems]-- "signs" --\x3eC([Runtime measurements])\n  B[CLI]-- "verifies (remote attestation)" --\x3eE[First node]\n  E[First node]-- "verifies (remote attestation)" --\x3eF[Other nodes]\n  C([Runtime measurements]) -.-> E[First node]\n  C([Runtime measurements]) -.-> F[Other nodes]'}),"\n",(0,i.jsx)(t.h3,{id:"upgrades",children:"Upgrades"}),"\n",(0,i.jsxs)(t.p,{children:["Whenever a cluster is ",(0,i.jsx)(t.a,{href:"/constellation/2.23/workflows/upgrade",children:"upgraded"})," to a new version of the node image, the CLI sends the corresponding runtime measurements via the Kubernetes API server. The new runtime measurements are stored in etcd within the cluster and replace any previous runtime measurements. The new runtime measurements are then used automatically by the JoinService for the verification of new nodes."]}),"\n",(0,i.jsx)(t.h2,{id:"references",children:"References"}),"\n","\n",(0,i.jsxs)(t.section,{"data-footnotes":!0,className:"footnotes",children:[(0,i.jsx)(t.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{id:"user-content-fn-1",children:["\n",(0,i.jsxs)(t.p,{children:["Linux IMA produces runtime measurements of user-space binaries.\nHowever, these measurements aren't deterministic and thus, PCR[10] can't be compared to a constant value.\nInstead, a policy engine must be used to verify the TPM event log against a policy. ",(0,i.jsx)(t.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-1-2","data-footnote-backref":"","aria-label":"Back to reference 1-2",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"2"})]})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-1-3","data-footnote-backref":"","aria-label":"Back to reference 1-3",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"3"})]})," ",(0,i.jsxs)(t.a,{href:"#user-content-fnref-1-4","data-footnote-backref":"","aria-label":"Back to reference 1-4",className:"data-footnote-backref",children:["\u21a9",(0,i.jsx)(t.sup,{children:"4"})]})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);