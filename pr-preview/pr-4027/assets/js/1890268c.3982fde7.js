"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[8488],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(96540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}},89691:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"architecture/orchestration","title":"Orchestrating Constellation clusters","description":"You can use the CLI to create a cluster on the supported cloud platforms.","source":"@site/versioned_docs/version-2.24/architecture/orchestration.md","sourceDirName":"architecture","slug":"/architecture/orchestration","permalink":"/constellation/architecture/orchestration","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.24/architecture/orchestration.md","tags":[],"version":"2.24","frontMatter":{},"sidebar":"docs","previous":{"title":"Overview","permalink":"/constellation/architecture/overview"},"next":{"title":"Versions and support","permalink":"/constellation/architecture/versions"}}');var i=n(74848),r=n(28453);const o={},a="Orchestrating Constellation clusters",c={},l=[{value:"Workspaces",id:"workspaces",level:2},{value:"Cluster creation process",id:"cluster-creation-process",level:2},{value:"Creation process details",id:"creation-process-details",level:3},{value:"Post-installation configuration",id:"post-installation-configuration",level:2},{value:"Upgrades",id:"upgrades",level:2},{value:"Attestation of upgrades",id:"attestation-of-upgrades",level:3}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"orchestrating-constellation-clusters",children:"Orchestrating Constellation clusters"})}),"\n",(0,i.jsx)(t.p,{children:"You can use the CLI to create a cluster on the supported cloud platforms.\nThe CLI provisions the resources in your cloud environment and initiates the initialization of your cluster.\nIt uses a set of parameters and an optional configuration file to manage your cluster installation.\nThe CLI is also used for updating your cluster."}),"\n",(0,i.jsx)(t.h2,{id:"workspaces",children:"Workspaces"}),"\n",(0,i.jsxs)(t.p,{children:["Each Constellation cluster has an associated ",(0,i.jsx)(t.em,{children:"workspace"}),".\nThe workspace is where data such as the Constellation state and config files are stored.\nEach workspace is associated with a single cluster and configuration.\nThe CLI stores state in the local filesystem making the current directory the active workspace.\nMultiple clusters require multiple workspaces, hence, multiple directories.\nNote that every operation on a cluster always has to be performed from the directory associated with its workspace."]}),"\n",(0,i.jsx)(t.p,{children:"You may copy files from the workspace to other locations,\nbut you shouldn't move or delete them while the cluster is still being used.\nThe Constellation CLI takes care of managing the workspace.\nOnly when a cluster was terminated, and you are sure the files aren't needed anymore, should you remove a workspace."}),"\n",(0,i.jsx)(t.h2,{id:"cluster-creation-process",children:"Cluster creation process"}),"\n",(0,i.jsxs)(t.p,{children:["To allow for fine-grained configuration of your cluster and cloud environment, Constellation supports an extensive configuration file with strong defaults. ",(0,i.jsx)(t.a,{href:"/constellation/workflows/config",children:"Generating the configuration file"})," is typically the first thing you do in the workspace."]}),"\n",(0,i.jsx)(t.p,{children:"Altogether, the following files are generated during the creation of a Constellation cluster and stored in the current workspace:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"a configuration file"}),"\n",(0,i.jsx)(t.li,{children:"a state file"}),"\n",(0,i.jsx)(t.li,{children:"a Base64-encoded master secret"}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/constellation/reference/terraform",children:"Terraform artifacts"}),", stored in subdirectories"]}),"\n",(0,i.jsxs)(t.li,{children:["a Kubernetes ",(0,i.jsx)(t.code,{children:"kubeconfig"})," file."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["After the initialization of your cluster, the CLI will provide you with a Kubernetes ",(0,i.jsx)(t.code,{children:"kubeconfig"})," file.\nThis file grants you access to your Kubernetes cluster and configures the ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/",children:"kubectl"})," tool.\nIn addition, the cluster's ",(0,i.jsx)(t.a,{href:"/constellation/architecture/orchestration#post-installation-configuration",children:"identifier"})," is returned and stored in the state file."]}),"\n",(0,i.jsx)(t.h3,{id:"creation-process-details",children:"Creation process details"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["The CLI ",(0,i.jsx)(t.code,{children:"apply"})," command first creates the confidential VM (CVM) resources in your cloud environment and configures the network"]}),"\n",(0,i.jsx)(t.li,{children:"Each CVM boots the Constellation node image and measures every component in the boot chain"}),"\n",(0,i.jsxs)(t.li,{children:["The first microservice launched in each node is the ",(0,i.jsx)(t.a,{href:"/constellation/architecture/microservices#bootstrapper",children:(0,i.jsx)(t.em,{children:"Bootstrapper"})})]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.em,{children:"Bootstrapper"})," waits until it either receives an initialization request or discovers an initialized cluster"]}),"\n",(0,i.jsxs)(t.li,{children:["The CLI then connects to the ",(0,i.jsx)(t.em,{children:"Bootstrapper"})," of a selected node, sends the configuration, and initiates the initialization of the cluster"]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.em,{children:"Bootstrapper"})," of ",(0,i.jsx)(t.strong,{children:"that"})," node ",(0,i.jsx)(t.a,{href:"/constellation/architecture/microservices#bootstrapper",children:"initializes the Kubernetes cluster"})," and deploys the other Constellation ",(0,i.jsx)(t.a,{href:"/constellation/architecture/microservices",children:"microservices"})," including the ",(0,i.jsx)(t.a,{href:"/constellation/architecture/microservices#joinservice",children:(0,i.jsx)(t.em,{children:"JoinService"})})]}),"\n",(0,i.jsxs)(t.li,{children:["Subsequently, the ",(0,i.jsx)(t.em,{children:"Bootstrappers"})," of the other nodes discover the initialized cluster and send join requests to the ",(0,i.jsx)(t.em,{children:"JoinService"})]}),"\n",(0,i.jsx)(t.li,{children:"As part of the join request each node includes an attestation statement of its boot measurements as authentication"}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.em,{children:"JoinService"})," verifies the attestation statements and joins the nodes to the Kubernetes cluster"]}),"\n",(0,i.jsx)(t.li,{children:"This process is repeated for every node joining the cluster later (e.g., through autoscaling)"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"post-installation-configuration",children:"Post-installation configuration"}),"\n",(0,i.jsxs)(t.p,{children:["Post-installation the CLI provides a configuration for ",(0,i.jsx)(t.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/",children:"accessing the cluster using the Kubernetes API"}),".\nThe ",(0,i.jsx)(t.code,{children:"kubeconfig"})," file provides the credentials and configuration for connecting and authenticating to the API server.\nOnce configured, orchestrate the Kubernetes cluster via ",(0,i.jsx)(t.code,{children:"kubectl"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"After the initialization, the CLI will present you with a couple of tokens:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.a,{href:"/constellation/architecture/keys#master-secret",children:(0,i.jsx)(t.em,{children:"master secret"})})," (stored in the ",(0,i.jsx)(t.code,{children:"constellation-mastersecret.json"})," file by default)"]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.a,{href:"/constellation/architecture/keys#cluster-identity",children:(0,i.jsx)(t.em,{children:"clusterID"})})," of your cluster in Base64 encoding"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["You can read more about these values and their meaning in the guide on ",(0,i.jsx)(t.a,{href:"/constellation/architecture/keys#cluster-identity",children:"cluster identity"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.em,{children:"master secret"})," must be kept secret and can be used to ",(0,i.jsx)(t.a,{href:"/constellation/workflows/recovery",children:"recover your cluster"}),".\nInstead of managing this secret manually, you can ",(0,i.jsx)(t.a,{href:"/constellation/architecture/keys#user-managed-key-management",children:"use your key management solution of choice"})," with Constellation."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.em,{children:"clusterID"})," uniquely identifies a cluster and can be used to ",(0,i.jsx)(t.a,{href:"/constellation/workflows/verify-cluster",children:"verify your cluster"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"upgrades",children:"Upgrades"}),"\n",(0,i.jsxs)(t.p,{children:["Constellation images and microservices may need to be upgraded to new versions during the lifetime of a cluster.\nConstellation implements a rolling update mechanism ensuring no downtime of the control or data plane.\nYou can upgrade a Constellation cluster with a single operation by using the CLI.\nFor step-by-step instructions on how to do this, refer to ",(0,i.jsx)(t.a,{href:"/constellation/workflows/upgrade",children:"Upgrade your cluster"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"attestation-of-upgrades",children:"Attestation of upgrades"}),"\n",(0,i.jsxs)(t.p,{children:["With every new image, corresponding measurements are released.\nDuring an update procedure, the CLI provides new measurements to the ",(0,i.jsx)(t.a,{href:"/constellation/architecture/microservices#joinservice",children:"JoinService"})," securely.\nNew measurements for an updated image are automatically pulled and verified by the CLI following the ",(0,i.jsx)(t.a,{href:"/constellation/architecture/attestation#chain-of-trust",children:"supply chain security concept"})," of Constellation.\nThe ",(0,i.jsx)(t.a,{href:"/constellation/architecture/attestation#cluster-facing-attestation",children:"attestation section"})," describes in detail how these measurements are then used by the JoinService for the attestation of nodes."]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);