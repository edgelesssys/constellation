"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[3325],{28453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>a});var n=s(96540);const o={},i=n.createContext(o);function r(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(i.Provider,{value:t},e.children)}},67532:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"workflows/s3proxy","title":"Install s3proxy","description":"Constellation includes a transparent client-side encryption proxy for AWS S3 and compatible stores.","source":"@site/versioned_docs/version-2.23/workflows/s3proxy.md","sourceDirName":"workflows","slug":"/workflows/s3proxy","permalink":"/constellation/2.23/workflows/s3proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.23/workflows/s3proxy.md","tags":[],"version":"2.23","frontMatter":{},"sidebar":"docs","previous":{"title":"Install cert-manager","permalink":"/constellation/2.23/workflows/cert-manager"},"next":{"title":"Terminate your cluster","permalink":"/constellation/2.23/workflows/terminate"}}');var o=s(74848),i=s(28453);const r={},a="Install s3proxy",l={},c=[{value:"Limitations",id:"limitations",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Technical details",id:"technical-details",level:2},{value:"Encryption",id:"encryption",level:3},{value:"Traffic interception",id:"traffic-interception",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"install-s3proxy",children:"Install s3proxy"})}),"\n",(0,o.jsxs)(t.p,{children:["Constellation includes a transparent client-side encryption proxy for ",(0,o.jsx)(t.a,{href:"https://aws.amazon.com/de/s3/",children:"AWS S3"})," and compatible stores.\ns3proxy encrypts objects before sending them to S3 and automatically decrypts them on retrieval, without requiring changes to your application.\nWith s3proxy, you can use S3 for storage in a confidential way without having to trust the storage provider."]}),"\n",(0,o.jsx)(t.h2,{id:"limitations",children:"Limitations"}),"\n",(0,o.jsx)(t.p,{children:"Currently, s3proxy has the following limitations:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Only ",(0,o.jsx)(t.code,{children:"PutObject"})," and ",(0,o.jsx)(t.code,{children:"GetObject"})," requests are encrypted/decrypted by s3proxy.\nBy default, s3proxy will block requests that may expose unencrypted data to S3 (e.g. UploadPart).\nThe ",(0,o.jsx)(t.code,{children:"allow-multipart"})," flag disables request blocking for evaluation purposes."]}),"\n",(0,o.jsxs)(t.li,{children:["Using the ",(0,o.jsx)(t.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html#API_GetObject_RequestSyntax",children:"Range"})," header on ",(0,o.jsx)(t.code,{children:"GetObject"})," is currently not supported and will result in an error."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["These limitations will be removed with future iterations of s3proxy.\nIf you want to use s3proxy but these limitations stop you from doing so, consider ",(0,o.jsx)(t.a,{href:"https://github.com/edgelesssys/constellation/issues/new?assignees=&labels=&projects=&template=feature_request.yml",children:"opening an issue"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"deployment",children:"Deployment"}),"\n",(0,o.jsx)(t.p,{children:"You can add the s3proxy to your Constellation cluster as follows:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Add the Edgeless Systems chart repository:","\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"helm repo add edgeless https://helm.edgeless.systems/stable\nhelm repo update\n"})}),"\n"]}),"\n",(0,o.jsx)(t.li,{children:"Set ACCESS_KEY and ACCESS_SECRET to valid credentials you want s3proxy to use to interact with S3."}),"\n",(0,o.jsxs)(t.li,{children:["Deploy s3proxy:","\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'helm install s3proxy edgeless/s3proxy --set awsAccessKeyID="$ACCESS_KEY" --set awsSecretAccessKey="$ACCESS_SECRET"\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["If you want to run a demo application, check out the ",(0,o.jsx)(t.a,{href:"/constellation/2.23/getting-started/examples/filestash-s3proxy",children:"Filestash with s3proxy"})," example."]}),"\n",(0,o.jsx)(t.h2,{id:"technical-details",children:"Technical details"}),"\n",(0,o.jsx)(t.h3,{id:"encryption",children:"Encryption"}),"\n",(0,o.jsxs)(t.p,{children:["s3proxy relies on Google's ",(0,o.jsx)(t.a,{href:"https://developers.google.com/tink",children:"Tink Cryptographic Library"})," to implement cryptographic operations securely.\nThe used cryptographic primitives are ",(0,o.jsx)(t.a,{href:"https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-38F.pdf",children:"NIST SP 800 38f"})," for key wrapping and ",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard",children:"AES"}),"-",(0,o.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Galois/counter_(GCM)",children:"GCM"})," with 256 bit keys for data encryption."]}),"\n",(0,o.jsxs)(t.p,{children:["s3proxy uses ",(0,o.jsx)(t.a,{href:"https://cloud.google.com/kms/docs/envelope-encryption",children:"envelope encryption"})," to encrypt objects.\nThis means s3proxy uses a key encryption key (KEK) issued by the ",(0,o.jsx)(t.a,{href:"/constellation/2.23/architecture/microservices#keyservice",children:"KeyService"})," to encrypt data encryption keys (DEKs).\nEach S3 object is encrypted with its own DEK.\nThe encrypted DEK is then saved as metadata of the encrypted object.\nThis enables key rotation of the KEK without re-encrypting the data in S3.\nThe approach also allows access to objects from different locations, as long as each location has access to the KEK."]}),"\n",(0,o.jsx)(t.h3,{id:"traffic-interception",children:"Traffic interception"}),"\n",(0,o.jsx)(t.p,{children:"To use s3proxy, you have to redirect your outbound S3 traffic to s3proxy.\nThis can either be done by modifying your client application or by changing the deployment of your application."}),"\n",(0,o.jsxs)(t.p,{children:["The necessary deployment modifications are to add DNS redirection and a trusted TLS certificate to the client's trust store.\nDNS redirection can be defined for each pod, allowing you to use s3proxy for one application without changing other applications in the same cluster.\nAdding a trusted TLS certificate is necessary as clients communicate with s3proxy via HTTPS.\nTo have your client application trust s3proxy's TLS certificate, the certificate has to be added to the client's certificate trust store.\nThe ",(0,o.jsx)(t.a,{href:"/constellation/2.23/getting-started/examples/filestash-s3proxy",children:"Filestash with s3proxy"})," example shows how to do this."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);