"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[3339],{28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>a});var n=i(96540);const s={},o=n.createContext(s);function r(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(o.Provider,{value:t},e.children)}},44780:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"architecture/images","title":"Constellation images","description":"Constellation uses a minimal version of Fedora as the operating system running inside confidential VMs. This Linux distribution is optimized for containers and designed to be stateless.","source":"@site/versioned_docs/version-2.24/architecture/images.md","sourceDirName":"architecture","slug":"/architecture/images","permalink":"/constellation/architecture/images","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.24/architecture/images.md","tags":[],"version":"2.24","frontMatter":{},"sidebar":"docs","previous":{"title":"Attestation","permalink":"/constellation/architecture/attestation"},"next":{"title":"Keys and cryptographic primitives","permalink":"/constellation/architecture/keys"}}');var s=i(74848),o=i(28453);const r={},a="Constellation images",d={},l=[{value:"Measured boot",id:"measured-boot",level:2},{value:"Firmware",id:"firmware",level:3},{value:"Bootloader",id:"bootloader",level:3},{value:"initramfs",id:"initramfs",level:3},{value:"State disk",id:"state-disk",level:2},{value:"Kubernetes components",id:"kubernetes-components",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"constellation-images",children:"Constellation images"})}),"\n",(0,s.jsx)(t.p,{children:"Constellation uses a minimal version of Fedora as the operating system running inside confidential VMs. This Linux distribution is optimized for containers and designed to be stateless.\nThe Constellation images provide measured boot and an immutable filesystem."}),"\n",(0,s.jsx)(t.h2,{id:"measured-boot",children:"Measured boot"}),"\n",(0,s.jsx)(t.mermaid,{value:"flowchart LR\n  Firmware   --\x3e Bootloader\n  Bootloader --\x3e uki\n  subgraph uki[Unified Kernel Image]\n  Kernel[Kernel]\n  initramfs[Initramfs]\n  cmdline[Kernel Command Line]\n  end\n  uki --\x3e rootfs[Root Filesystem]"}),"\n",(0,s.jsx)(t.p,{children:"Measured boot uses a Trusted Platform Module (TPM) to measure every part of the boot process. This allows for verification of the integrity of a running system at any point in time. To ensure correct measurements of every stage, each stage is responsible to measure the next stage before transitioning."}),"\n",(0,s.jsx)(t.h3,{id:"firmware",children:"Firmware"}),"\n",(0,s.jsx)(t.p,{children:"With confidential VMs, the firmware is the root of trust and is measured automatically at boot. After initialization, the firmware will load and measure the bootloader before executing it."}),"\n",(0,s.jsx)(t.h3,{id:"bootloader",children:"Bootloader"}),"\n",(0,s.jsx)(t.p,{children:"The bootloader is the first modifiable part of the boot chain. The bootloader is tasked with loading the kernel, initramfs and setting the kernel command line. The Constellation bootloader measures these components before starting the kernel."}),"\n",(0,s.jsx)(t.h3,{id:"initramfs",children:"initramfs"}),"\n",(0,s.jsxs)(t.p,{children:["The initramfs is a small filesystem loaded to prepare the actual root filesystem. The Constellation initramfs maps the block device containing the root filesystem with ",(0,s.jsx)(t.a,{href:"https://www.kernel.org/doc/html/latest/admin-guide/device-mapper/verity.html",children:"dm-verity"}),". The initramfs then mounts the root filesystem from the mapped block device."]}),"\n",(0,s.jsx)(t.p,{children:"dm-verity provides integrity checking using a cryptographic hash tree. When a block is read, its integrity is checked by verifying the tree against a trusted root hash. The initramfs reads this root hash from the previously measured kernel command line. Thus, if any block of the root filesystem's device is modified on disk, trying to read the modified block will result in a kernel panic at runtime."}),"\n",(0,s.jsxs)(t.p,{children:["After mounting the root filesystem, the initramfs will switch over and start the ",(0,s.jsx)(t.code,{children:"init"})," process of the integrity-protected root filesystem."]}),"\n",(0,s.jsx)(t.h2,{id:"state-disk",children:"State disk"}),"\n",(0,s.jsxs)(t.p,{children:["In addition to the read-only root filesystem, each Constellation node has a disk for storing state data.\nThis disk is mounted readable and writable by the initramfs and contains data that should persist across reboots.\nSuch data can contain sensitive information and, therefore, must be stored securely.\nTo that end, the state disk is protected by authenticated encryption.\nSee the section on ",(0,s.jsx)(t.a,{href:"/constellation/architecture/keys#storage-encryption",children:"keys and encryption"})," for more information on the cryptographic primitives in use."]}),"\n",(0,s.jsx)(t.h2,{id:"kubernetes-components",children:"Kubernetes components"}),"\n",(0,s.jsxs)(t.p,{children:["During initialization, the ",(0,s.jsx)(t.a,{href:"/constellation/architecture/microservices#bootstrapper",children:(0,s.jsx)(t.em,{children:"Bootstrapper"})})," downloads and verifies the ",(0,s.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/overview/components/",children:"Kubernetes components"})," as configured by the user.\nThey're stored on the state partition and can be updated once new releases need to be installed."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);