"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[417],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var o=s(96540);const l={},r=o.createContext(l);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),o.createElement(r.Provider,{value:n},e.children)}},54775:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"workflows/scale","title":"Scale your cluster","description":"Constellation provides all features of a Kubernetes cluster including scaling and autoscaling.","source":"@site/versioned_docs/version-2.22/workflows/scale.md","sourceDirName":"workflows","slug":"/workflows/scale","permalink":"/constellation/2.22/workflows/scale","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.22/workflows/scale.md","tags":[],"version":"2.22","frontMatter":{},"sidebar":"docs","previous":{"title":"Create your cluster","permalink":"/constellation/2.22/workflows/create"},"next":{"title":"Upgrade your cluster","permalink":"/constellation/2.22/workflows/upgrade"}}');var l=s(74848),r=s(28453);const t={},c="Scale your cluster",i={},a=[{value:"Worker node scaling",id:"worker-node-scaling",level:2},{value:"Autoscaling",id:"autoscaling",level:3},{value:"Manual scaling",id:"manual-scaling",level:3},{value:"Control-plane node scaling",id:"control-plane-node-scaling",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},{TabItem:s,Tabs:o}=n;return s||h("TabItem",!0),o||h("Tabs",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"scale-your-cluster",children:"Scale your cluster"})}),"\n",(0,l.jsx)(n.p,{children:"Constellation provides all features of a Kubernetes cluster including scaling and autoscaling."}),"\n",(0,l.jsx)(n.h2,{id:"worker-node-scaling",children:"Worker node scaling"}),"\n",(0,l.jsx)(n.h3,{id:"autoscaling",children:"Autoscaling"}),"\n",(0,l.jsx)(n.p,{children:"Constellation comes with autoscaling disabled by default. To enable autoscaling, find the scaling group of\nworker nodes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'kubectl get scalinggroups -o json | yq \'.items | .[] | select(.spec.role == "Worker") | [{"name": .metadata.name, "nodeGoupName": .spec.nodeGroupName}]\'\n'})}),"\n",(0,l.jsxs)(n.p,{children:["This will output a list of scaling groups with the corresponding cloud provider name (",(0,l.jsx)(n.code,{children:"name"}),") and the cloud provider agnostic name of the node group (",(0,l.jsx)(n.code,{children:"nodeGroupName"}),")."]}),"\n",(0,l.jsxs)(n.p,{children:["Then, patch the ",(0,l.jsx)(n.code,{children:"autoscaling"})," field of the scaling group resource with the desired ",(0,l.jsx)(n.code,{children:"name"})," to ",(0,l.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Replace <name> with the name of the scaling group you want to enable autoscaling for\nworker_group=<name>\nkubectl patch scalinggroups $worker_group --patch '{\"spec\":{\"autoscaling\": true}}' --type='merge'\nkubectl get scalinggroup $worker_group -o jsonpath='{.spec}' | yq -P\n"})}),"\n",(0,l.jsxs)(n.p,{children:["The cluster autoscaler now automatically provisions additional worker nodes so that all pods have a place to run.\nYou can configure the minimum and maximum number of worker nodes in the scaling group by patching the ",(0,l.jsx)(n.code,{children:"min"})," or\n",(0,l.jsx)(n.code,{children:"max"})," fields of the scaling group resource:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl patch scalinggroups $worker_group --patch '{\"spec\":{\"max\": 5}}' --type='merge'\nkubectl get scalinggroup $worker_group -o jsonpath='{.spec}' | yq -P\n"})}),"\n",(0,l.jsx)(n.p,{children:"The cluster autoscaler will now never provision more than 5 worker nodes."}),"\n",(0,l.jsx)(n.p,{children:"If you want to see the autoscaling in action, try to add a deployment with a lot of replicas, like the\nfollowing Nginx deployment. The number of replicas needed to trigger the autoscaling depends on the size of\nand count of your worker nodes. Wait for the rollout of the deployment to finish and compare the number of\nworker nodes before and after the deployment:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl create deployment nginx --image=nginx --replicas 150\nkubectl -n kube-system get nodes\nkubectl rollout status deployment nginx\nkubectl -n kube-system get nodes\n"})}),"\n",(0,l.jsx)(n.h3,{id:"manual-scaling",children:"Manual scaling"}),"\n",(0,l.jsx)(n.p,{children:"Alternatively, you can manually scale your cluster up or down:"}),"\n",(0,l.jsxs)(o,{groupId:"csp",children:[(0,l.jsx)(s,{value:"aws",label:"AWS",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Go to Auto Scaling Groups and select the worker ASG to scale up."}),"\n",(0,l.jsxs)(n.li,{children:["Click ",(0,l.jsx)(n.strong,{children:"Edit"})]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new (increased) ",(0,l.jsx)(n.strong,{children:"Desired capacity"})," and ",(0,l.jsx)(n.strong,{children:"Update"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"azure",label:"Azure",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Find your Constellation resource group."}),"\n",(0,l.jsxs)(n.li,{children:["Select the ",(0,l.jsx)(n.code,{children:"scale-set-workers"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Go to ",(0,l.jsx)(n.strong,{children:"settings"})," and ",(0,l.jsx)(n.strong,{children:"scaling"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new ",(0,l.jsx)(n.strong,{children:"instance count"})," and ",(0,l.jsx)(n.strong,{children:"save"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"gcp",label:"GCP",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["In Compute Engine go to ",(0,l.jsx)(n.a,{href:"https://console.cloud.google.com/compute/instanceGroups/",children:"Instance Groups"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Edit"})," the ",(0,l.jsx)(n.strong,{children:"worker"})," instance group."]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new ",(0,l.jsx)(n.strong,{children:"number of instances"})," and ",(0,l.jsx)(n.strong,{children:"save"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"stackit",label:"STACKIT",children:(0,l.jsx)(n.p,{children:"Dynamic cluster scaling isn't yet supported for STACKIT.\nSupport will be introduced in one of the upcoming releases."})})]}),"\n",(0,l.jsx)(n.h2,{id:"control-plane-node-scaling",children:"Control-plane node scaling"}),"\n",(0,l.jsxs)(n.p,{children:["Control-plane nodes can ",(0,l.jsx)(n.strong,{children:"only be scaled manually and only scaled up"}),"!"]}),"\n",(0,l.jsx)(n.p,{children:"To increase the number of control-plane nodes, follow these steps:"}),"\n",(0,l.jsxs)(o,{groupId:"csp",children:[(0,l.jsx)(s,{value:"aws",label:"AWS",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Go to Auto Scaling Groups and select the control-plane ASG to scale up."}),"\n",(0,l.jsxs)(n.li,{children:["Click ",(0,l.jsx)(n.strong,{children:"Edit"})]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new (increased) ",(0,l.jsx)(n.strong,{children:"Desired capacity"})," and ",(0,l.jsx)(n.strong,{children:"Update"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"azure",label:"Azure",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Find your Constellation resource group."}),"\n",(0,l.jsxs)(n.li,{children:["Select the ",(0,l.jsx)(n.code,{children:"scale-set-controlplanes"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Go to ",(0,l.jsx)(n.strong,{children:"settings"})," and ",(0,l.jsx)(n.strong,{children:"scaling"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new (increased) ",(0,l.jsx)(n.strong,{children:"instance count"})," and ",(0,l.jsx)(n.strong,{children:"save"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"gcp",label:"GCP",children:(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["In Compute Engine go to ",(0,l.jsx)(n.a,{href:"https://console.cloud.google.com/compute/instanceGroups/",children:"Instance Groups"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Edit"})," the ",(0,l.jsx)(n.strong,{children:"control-plane"})," instance group."]}),"\n",(0,l.jsxs)(n.li,{children:["Set the new (increased) ",(0,l.jsx)(n.strong,{children:"number of instances"})," and ",(0,l.jsx)(n.strong,{children:"save"}),"."]}),"\n"]})}),(0,l.jsx)(s,{value:"stackit",label:"STACKIT",children:(0,l.jsx)(n.p,{children:"Dynamic cluster scaling isn't yet supported for STACKIT.\nSupport will be introduced in one of the upcoming releases."})})]}),"\n",(0,l.jsxs)(n.p,{children:["If you scale down the number of control-planes nodes, the removed nodes won't be able to exit the ",(0,l.jsx)(n.code,{children:"etcd"})," cluster correctly. This will endanger the quorum that's required to run a stable Kubernetes control plane."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}function h(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);