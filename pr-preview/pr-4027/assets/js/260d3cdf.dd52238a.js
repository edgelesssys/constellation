"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[9619],{16301:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"architecture/microservices","title":"Microservices","description":"Constellation takes care of bootstrapping and initializing a Confidential Kubernetes cluster.","source":"@site/versioned_docs/version-2.24/architecture/microservices.md","sourceDirName":"architecture","slug":"/architecture/microservices","permalink":"/constellation/architecture/microservices","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/versioned_docs/version-2.24/architecture/microservices.md","tags":[],"version":"2.24","frontMatter":{},"sidebar":"docs","previous":{"title":"Versions and support","permalink":"/constellation/architecture/versions"},"next":{"title":"Attestation","permalink":"/constellation/architecture/attestation"}}');var r=n(74848),s=n(28453);const o={},a="Microservices",c={},l=[{value:"Bootstrapper",id:"bootstrapper",level:2},{value:"JoinService",id:"joinservice",level:2},{value:"VerificationService",id:"verificationservice",level:2},{value:"KeyService",id:"keyservice",level:2}];function d(e){const t={a:"a",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"microservices",children:"Microservices"})}),"\n",(0,r.jsx)(t.p,{children:"Constellation takes care of bootstrapping and initializing a Confidential Kubernetes cluster.\nDuring the lifetime of the cluster, it handles day 2 operations such as key management, remote attestation, and updates.\nThese features are provided by several microservices:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#bootstrapper",children:"Bootstrapper"})," initializes a Constellation node and bootstraps the cluster"]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#joinservice",children:"JoinService"})," joins new nodes to an existing cluster"]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#verificationservice",children:"VerificationService"})," provides remote attestation functionality"]}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#keyservice",children:"KeyService"})," manages Constellation-internal keys"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The relations between microservices are shown in the following diagram:"}),"\n",(0,r.jsx)(t.mermaid,{value:"flowchart LR\n    subgraph admin [Admin's machine]\n        A[Constellation CLI]\n    end\n    subgraph img [Constellation OS image]\n        B[Constellation OS]\n        C[Bootstrapper]\n    end\n    subgraph Kubernetes\n        D[JoinService]\n        E[KeyService]\n        F[VerificationService]\n    end\n    A -- deploys --\x3e\n    B -- starts --\x3e C\n    C -- deploys --\x3e D\n    C -- deploys --\x3e E\n    C -- deploys --\x3e F"}),"\n",(0,r.jsx)(t.h2,{id:"bootstrapper",children:"Bootstrapper"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"Bootstrapper"})," is the first microservice launched after booting a Constellation node image.\nIt sets up that machine as a Kubernetes node and integrates that node into the Kubernetes cluster.\nTo this end, the ",(0,r.jsx)(t.em,{children:"Bootstrapper"})," first downloads and verifies the ",(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/overview/components/",children:"Kubernetes components"})," at the configured versions.\nThe ",(0,r.jsx)(t.em,{children:"Bootstrapper"})," tries to find an existing cluster and if successful, communicates with the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#joinservice",children:"JoinService"})," to join the node.\nOtherwise, it waits for an initialization request to create a new Kubernetes cluster."]}),"\n",(0,r.jsx)(t.h2,{id:"joinservice",children:"JoinService"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"JoinService"})," runs as ",(0,r.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/",children:"DaemonSet"})," on each control-plane node.\nNew nodes (at cluster start, or later through autoscaling) send a request to the service over ",(0,r.jsx)(t.a,{href:"/constellation/architecture/attestation#attested-tls-atls",children:"attested TLS (aTLS)"}),".\nThe ",(0,r.jsx)(t.em,{children:"JoinService"})," verifies the new node's certificate and attestation statement.\nIf attestation is successful, the new node is supplied with an encryption key from the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/microservices#keyservice",children:(0,r.jsx)(t.em,{children:"KeyService"})})," for its state disk, and a Kubernetes bootstrap token."]}),"\n",(0,r.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant New node\n    participant JoinService\n    New node->>JoinService: aTLS handshake (server side verification)\n    JoinService--\x3e>New node: #\n    New node->>+JoinService: IssueJoinTicket(DiskUUID, NodeName, IsControlPlane)\n    JoinService->>+KeyService: GetDataKey(DiskUUID)\n    KeyService--\x3e>-JoinService: DiskEncryptionKey\n    JoinService--\x3e>-New node: DiskEncryptionKey, KubernetesJoinToken, ..."}),"\n",(0,r.jsx)(t.h2,{id:"verificationservice",children:"VerificationService"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"VerificationService"})," runs as DaemonSet on each node.\nIt provides user-facing functionality for remote attestation during the cluster's lifetime via an endpoint for ",(0,r.jsx)(t.a,{href:"/constellation/architecture/attestation#cluster-attestation",children:"verifying the cluster"}),".\nRead more about the hardware-based ",(0,r.jsx)(t.a,{href:"/constellation/architecture/attestation",children:"attestation feature"})," of Constellation and how to ",(0,r.jsx)(t.a,{href:"/constellation/workflows/verify-cluster",children:"verify"})," a cluster on the client side."]}),"\n",(0,r.jsx)(t.h2,{id:"keyservice",children:"KeyService"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.em,{children:"KeyService"})," runs as DaemonSet on each control-plane node.\nIt implements the key management for the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/keys#storage-encryption",children:"storage encryption keys"})," in Constellation. These keys are used for the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/images#state-disk",children:"state disk"})," of each node and the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/encrypted-storage",children:"transparently encrypted storage"})," for Kubernetes.\nDepending on wether the ",(0,r.jsx)(t.a,{href:"/constellation/architecture/keys#constellation-managed-key-management",children:"constellation-managed"})," or ",(0,r.jsx)(t.a,{href:"/constellation/architecture/keys#user-managed-key-management",children:"user-managed"})," mode is used, the ",(0,r.jsx)(t.em,{children:"KeyService"})," holds the key encryption key (KEK) directly or calls an external key management service (KMS) for key derivation respectively."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(96540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);