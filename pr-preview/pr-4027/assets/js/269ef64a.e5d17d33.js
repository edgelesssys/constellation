"use strict";(globalThis.webpackChunkconstellation_docs=globalThis.webpackChunkconstellation_docs||[]).push([[6664],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>l});var r=n(96540);const o={},s=r.createContext(o);function i(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:t},e.children)}},35080:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"workflows/create","title":"Create your cluster","description":"This recording presents the essence of this page. It\'s recommended to read it in full for the motivation and all details.","source":"@site/docs/workflows/create.md","sourceDirName":"workflows","slug":"/workflows/create","permalink":"/constellation/next/workflows/create","draft":false,"unlisted":false,"editUrl":"https://github.com/edgelesssys/constellation/edit/main/docs/docs/workflows/create.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Configure your cluster","permalink":"/constellation/next/workflows/config"},"next":{"title":"Scale your cluster","permalink":"/constellation/next/workflows/scale"}}');var o=n(74848),s=n(28453);const i={},l="Create your cluster",a={},c=[{value:"Troubleshooting",id:"troubleshooting",level:3}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components},{AsciinemaWidget:n,TabItem:r,Tabs:i}=t;return n||h("AsciinemaWidget",!0),r||h("TabItem",!0),i||h("Tabs",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"create-your-cluster",children:"Create your cluster"})}),"\n",(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsx)(t.p,{children:"This recording presents the essence of this page. It's recommended to read it in full for the motivation and all details."})}),"\n",(0,o.jsx)(n,{src:"/constellation/assets/create-cluster.cast",rows:"20",cols:"112",idleTimeLimit:"3",preload:"true",theme:"edgeless"}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:"Creating your cluster happens through multiple phases.\nThe most significant ones are:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Creating the necessary resources in your cloud environment"}),"\n",(0,o.jsx)(t.li,{children:"Bootstrapping the Constellation cluster and setting up a connection"}),"\n",(0,o.jsx)(t.li,{children:"Installing the necessary Kubernetes components"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"constellation apply"})," handles all this in a single command.\nYou can use the ",(0,o.jsx)(t.code,{children:"--skip-phases"})," flag to skip specific phases of the process.\nFor example, if you created the infrastructure manually, you can skip the cloud resource creation phase."]}),"\n",(0,o.jsxs)(t.p,{children:["See the ",(0,o.jsx)(t.a,{href:"/constellation/next/architecture/orchestration",children:"architecture"})," section for details on the inner workings of this process."]}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["If you don't have a cloud subscription, you can also set up a ",(0,o.jsx)(t.a,{href:"/constellation/next/getting-started/first-steps-local",children:"local Constellation cluster using virtualization"})," for testing."]})}),"\n",(0,o.jsxs)(t.p,{children:["Before you create the cluster, make sure to have a ",(0,o.jsx)(t.a,{href:"/constellation/next/workflows/config",children:"valid configuration file"}),"."]}),"\n",(0,o.jsxs)(i,{groupId:"usage",children:[(0,o.jsxs)(r,{value:"cli",label:"CLI",children:[(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"constellation apply\n"})}),(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"apply"})," stores the state of your cluster's cloud resources in a ",(0,o.jsx)(t.a,{href:"/constellation/next/architecture/orchestration#cluster-creation-process",children:(0,o.jsx)(t.code,{children:"constellation-terraform"})})," directory in your workspace."]})]}),(0,o.jsxs)(r,{value:"self-managed",label:"Self-managed",children:[(0,o.jsx)(t.p,{children:"Self-managed infrastructure allows for more flexibility in the setup, by separating the infrastructure setup from the Constellation cluster management.\nThis provides flexibility in DevOps and can meet potential regulatory requirements.\nIt's recommended to use Terraform for infrastructure management, but you can use any tool of your choice."}),(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsxs)(t.p,{children:["When using Terraform, you can use the ",(0,o.jsx)(t.a,{href:"/constellation/next/workflows/terraform-provider",children:"Constellation Terraform provider"})," to manage the entire Constellation cluster lifecycle."]})}),(0,o.jsxs)(t.p,{children:["You can refer to the Terraform files for the selected CSP from the ",(0,o.jsx)(t.a,{href:"https://github.com/edgelesssys/constellation/tree/main/terraform/infrastructure",children:"Constellation GitHub repository"})," for a minimum Constellation cluster configuration. From this base, you can now add, edit, or substitute resources per your own requirements with the infrastructure\nmanagement tooling of your choice. You need to keep the essential functionality of the base configuration in order for your cluster to function correctly."]}),(0,o.jsxs)(t.admonition,{type:"info",children:[(0,o.jsxs)(t.p,{children:["On Azure, a manual update to the MAA provider's policy is necessary.\nYou can apply the update with the following command after creating the infrastructure, with ",(0,o.jsx)(t.code,{children:"<URL>"})," being the URL of the MAA provider (i.e., ",(0,o.jsx)(t.code,{children:"$(terraform output attestation_url | jq -r)"}),", when using the minimal Terraform configuration)."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"constellation maa-patch <URL>\n"})})]}),(0,o.jsxs)(t.p,{children:["Make sure all necessary resources are created, e.g., through checking your CSP's portal and retrieve the necessary values, aligned with the outputs (specified in ",(0,o.jsx)(t.code,{children:"outputs.tf"}),") of the base configuration."]}),(0,o.jsxs)(t.p,{children:["Fill these outputs into the corresponding fields of the ",(0,o.jsx)(t.code,{children:"Infrastructure"})," block inside the ",(0,o.jsx)(t.code,{children:"constellation-state.yaml"})," file. For example, fill the IP or DNS name your cluster can be reached at into the ",(0,o.jsx)(t.code,{children:".Infrastructure.ClusterEndpoint"})," field."]}),(0,o.jsx)(t.p,{children:"With the required cloud resources set up, continue with initializing your cluster."}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"constellation apply --skip-phases=infrastructure\n"})})]})]}),"\n",(0,o.jsxs)(t.p,{children:["Finally, configure ",(0,o.jsx)(t.code,{children:"kubectl"})," for your cluster:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'export KUBECONFIG="$PWD/constellation-admin.conf"\n'})}),"\n",(0,o.jsx)(t.p,{children:"\ud83c\udfc1 That's it. You've successfully created a Constellation cluster."}),"\n",(0,o.jsx)(t.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsxs)(t.p,{children:["In case ",(0,o.jsx)(t.code,{children:"apply"})," fails, the CLI collects logs from the bootstrapping instance and stores them inside ",(0,o.jsx)(t.code,{children:"constellation-cluster.log"}),"."]})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}function h(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);